<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":"falses"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="iOS developer">
<meta property="og:type" content="website">
<meta property="og:title" content="我不是诸葛亮">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="我不是诸葛亮">
<meta property="og:description" content="iOS developer">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhuguanliang">
<meta property="article:tag" content="Swift Object-C">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>我不是诸葛亮</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="我不是诸葛亮" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">我不是诸葛亮</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">宁可碌碌，不可无为</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/12/16/UIView%E7%9A%84%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/16/UIView%E7%9A%84%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB/" class="post-title-link" itemprop="url">UIView的继承体系</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-12-16 13:49:59 / 修改时间：14:49:00" itemprop="dateCreated datePublished" datetime="2019-12-16T13:49:59+08:00">2019-12-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>UIView继承体系中的类具有不同的层次关系。其中，UIView继承自UIResponder，它提供了许多子类，如表示标签的UILabeI、表示图片的UIImageView、表示可交互控件的UIControI等。同样，UIControI类也提供了很多子类，比如表示按钮的UIButton、表示文本框的UITextFieId等。</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210518134602203.png" alt="image-20210518134602203"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/12/15/swift%E9%A1%B9%E7%9B%AE%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/15/swift%E9%A1%B9%E7%9B%AE%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">swift项目程序的启动原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-12-15 13:12:58 / 修改时间：14:49:00" itemprop="dateCreated datePublished" datetime="2019-12-15T13:12:58+08:00">2019-12-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="程序启动的原理"><a href="#程序启动的原理" class="headerlink" title="程序启动的原理"></a>程序启动的原理</h2><p>  当在OC创建的项目中，一定会有一个main.m文件，里面有一个main函数，可以在这个函数中启动App。但是在创建的Swift项目中，我们会发现，并没有名为main.swift的文件。因为Swift项目中添加了@UIAppIictationMain到Swift文件中，使得编译器默认生成了一个main函数，所以不需要main.swift文件。</p>
<p>启动的完整过程：</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210518121958533.png" alt="image-20210518121958533"></p>
<p>（1）Swift应用程序在打开时，@UIAppIictationMain会自动生成main函数。</p>
<p>（2）main函数会调用UIAppIicationMain，创建UIAppIication对象和UIAppIication的代理对象。</p>
<p>（3）启动项目，分为两种情况：</p>
<p>① 不使用storyboard时，代理对象开始监听系统事件，在程序启动完毕时，调用代理的appIication:didFinishLaunchingWithOptions：方法，在方法中创建UIWindow，并创建和设置UIWindow的rootViewControIIer，最后显示窗口。</p>
<p>② 使用storyboard时，会直接创建UIWindow，并创建UIWindow的rootViewControIIer，然后显示窗口。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/12/14/OC%E4%B8%AD%E5%AE%9A%E4%BD%8D%E5%92%8C%E8%AF%B7%E6%B1%82%E4%BD%8D%E7%BD%AE%E6%9D%83%E9%99%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/14/OC%E4%B8%AD%E5%AE%9A%E4%BD%8D%E5%92%8C%E8%AF%B7%E6%B1%82%E4%BD%8D%E7%BD%AE%E6%9D%83%E9%99%90/" class="post-title-link" itemprop="url">Object—C中定位和请求位置权限</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-14 13:12:58" itemprop="dateCreated datePublished" datetime="2019-12-14T13:12:58+08:00">2019-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-01 14:49:00" itemprop="dateModified" datetime="2022-02-01T14:49:00+08:00">2022-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Object—C中定位和请求位置权限的处理"><a href="#Object—C中定位和请求位置权限的处理" class="headerlink" title="Object—C中定位和请求位置权限的处理"></a>Object—C中定位和请求位置权限的处理</h1><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514131658392.png" alt="image-20210514131658392" style="zoom:50%;">

<p>新建GTLocation(NSObject)</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514132100151.png" alt="image-20210514132100151" style="zoom:50%;">

<h2 id="完成单例的类"><a href="#完成单例的类" class="headerlink" title="完成单例的类"></a>完成单例的类</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514122910276.png" alt="image-20210514122910276"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTLocation.h&quot;</span><br><span class="line"></span><br><span class="line">@interface GTLocation()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTLocation</span><br><span class="line"></span><br><span class="line">+ (GTLocation *)locationManager&#123;</span><br><span class="line">    static GTLocation *location;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        location = [[GTLocation alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return location;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117182054304.png" alt="image-20210117182054304"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> App中统一的位置信息管理</span><br><span class="line"> */</span><br><span class="line">@interface GTLocation : NSObject</span><br><span class="line"></span><br><span class="line">+ (GTLocation *)locationManager;</span><br><span class="line"></span><br><span class="line">- (void)checkLocationAuthorization;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<h3 id="首次安装请求位置权限的获取"><a href="#首次安装请求位置权限的获取" class="headerlink" title="首次安装请求位置权限的获取"></a>首次安装请求位置权限的获取</h3><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514131658392.png" style="zoom:50%;">

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117182925438.png" alt="image-20210117182925438"></p>
<img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117185026565.png" alt="image-20210117185026565" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;CoreLocation/CoreLocation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTLocation()&lt;CLLocationManagerDelegate&gt;</span><br><span class="line">@property(nonatomic, strong, readwrite) CLLocationManager *manager;</span><br><span class="line"></span><br><span class="line">        self.manager = [[CLLocationManager alloc] init];</span><br><span class="line">        self.manager.delegate = self;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">//判断APP相应的状态</span><br><span class="line">- (void)checkLocationAuthorization&#123;</span><br><span class="line">    </span><br><span class="line">    //判断系统是否开启</span><br><span class="line">    if(![CLLocationManager locationServicesEnabled])&#123;</span><br><span class="line">        //引导弹窗</span><br><span class="line">        //</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if([CLLocationManager authorizationStatus] == kCLAuthorizationStatusNotDetermined)&#123;</span><br><span class="line">        [self.manager requestWhenInUseAuthorization];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - delegate</span><br><span class="line"></span><br><span class="line">- (void)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status&#123;</span><br><span class="line">    if (status == kCLAuthorizationStatusAuthorizedWhenInUse) &#123;</span><br><span class="line">        //</span><br><span class="line">        [self.manager startUpdatingLocation];</span><br><span class="line">        </span><br><span class="line">    &#125;else if (status == kCLAuthorizationStatusDenied)&#123;</span><br><span class="line">        //</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117185924011.png" alt="image-20210117185924011"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117185938825.png" alt="image-20210117185938825"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTLocation.h&quot;</span><br><span class="line"></span><br><span class="line">[[GTLocation locationManager] checkLocationAuthorization];</span><br></pre></td></tr></table></figure>

<h3 id="获取当前位置信息"><a href="#获取当前位置信息" class="headerlink" title="获取当前位置信息"></a><em>获取当前位置信息</em></h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514123220586.png" alt="image-20210514123220586"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (void)locationManager:(CLLocationManager *)manager</span><br><span class="line">     didUpdateLocations:(NSArray&lt;CLLocation *&gt; *)locations &#123;</span><br><span class="line">    </span><br><span class="line">    //地理信息</span><br><span class="line">    CLLocation *location = [locations firstObject];</span><br><span class="line">    </span><br><span class="line">    CLGeocoder *coder = [[CLGeocoder alloc] init];</span><br><span class="line">    </span><br><span class="line">    [coder reverseGeocodeLocation:location completionHandler:^(NSArray&lt;CLPlacemark *&gt; * _Nullable placemarks, NSError * _Nullable error) &#123;</span><br><span class="line">        //地标信息</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">     [self.manager stopUpdatingLocation];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/12/14/OC%E4%B8%AD%E7%9A%84%E6%8E%A8%E9%80%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/14/OC%E4%B8%AD%E7%9A%84%E6%8E%A8%E9%80%81/" class="post-title-link" itemprop="url">OC中的推送</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-14 13:12:58" itemprop="dateCreated datePublished" datetime="2019-12-14T13:12:58+08:00">2019-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-01 14:49:00" itemprop="dateModified" datetime="2022-02-01T14:49:00+08:00">2022-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Object-C中的本地推送"><a href="#Object-C中的本地推送" class="headerlink" title="Object-C中的本地推送"></a>Object-C中的本地推送</h1><img src="https://gitee.com/zhu565615430/images/raw/master/imas/output.GIF" alt="output" style="zoom: 25%;">

<h2 id="新建单例GTNotification-NSObject"><a href="#新建单例GTNotification-NSObject" class="headerlink" title="新建单例GTNotification(NSObject)"></a>新建单例GTNotification(NSObject)</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514133430205.png" alt="image-20210514133430205"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTNotification.h&quot;</span><br><span class="line">#import &lt;UserNotifications/UserNotifications.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTNotification ()&lt;UNUserNotificationCenterDelegate&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTNotification</span><br><span class="line">+ (GTNotification *)notificationManager&#123;</span><br><span class="line">    static GTNotification *manager;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manager = [[GTNotification alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)checkNotificationAuthorization&#123;</span><br><span class="line">    </span><br><span class="line">    UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">    center.delegate = self;</span><br><span class="line">    [center requestAuthorizationWithOptions:UNAuthorizationOptionBadge | UNAuthorizationOptionSound completionHandler:^(BOOL granted, NSError * _Nullable error) &#123;</span><br><span class="line">        NSLog(@&quot;&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224431147.png" alt="image-20210117224431147"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> APP 推送管理</span><br><span class="line"> */</span><br><span class="line">@interface GTNotification : NSObject</span><br><span class="line"></span><br><span class="line">+ (GTNotification *)notificationManager;</span><br><span class="line"></span><br><span class="line">- (void)checkNotificationAuthorization;//效验权限的方法</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224516134.png" alt="image-20210117224516134"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224553185.png" alt="image-20210117224553185"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTNotification.h&quot;</span><br><span class="line"></span><br><span class="line">[[GTNotification notificationManager] checkNotificationAuthorization];</span><br></pre></td></tr></table></figure>

<h2 id="实现本地推送"><a href="#实现本地推送" class="headerlink" title="实现本地推送"></a>实现本地推送</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117231013306.png" alt="image-20210117231013306"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117231031479.png" alt="image-20210117231031479"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">if (granted) &#123;</span><br><span class="line">            //本地推送</span><br><span class="line">            [self _pushLocalNotification];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)_pushLocalNotification&#123;</span><br><span class="line">    </span><br><span class="line">    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];</span><br><span class="line">    content.badge = @(1);</span><br><span class="line">    content.title = @&quot;北京时间&quot;;</span><br><span class="line">    content.body = @&quot;这是一款iOS App&quot;;</span><br><span class="line">    content.sound = [UNNotificationSound defaultSound];</span><br><span class="line">    </span><br><span class="line">    UNTimeIntervalNotificationTrigger *trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:30.f repeats:NO];</span><br><span class="line">    </span><br><span class="line">    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:@&quot;_pushLocalNotification&quot; content:content trigger:trigger];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) &#123;</span><br><span class="line">        //</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">  2      </span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler&#123;</span><br><span class="line">    completionHandler(UNNotificationPresentationOptionBanner);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)(void))completionHandler &#123;</span><br><span class="line">    </span><br><span class="line">    //处理badge展示逻辑</span><br><span class="line">    //点击之后根据业务逻辑处理</span><br><span class="line">    //[UIApplication sharedApplication].applicationIconBadgeNumber = 100;</span><br><span class="line"></span><br><span class="line">    //处理业务逻辑</span><br><span class="line">    completionHandler();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/09/16/Swift%E7%94%A8Delegate%E5%8D%8F%E8%AE%AE%E4%BC%A0%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/16/Swift%E7%94%A8Delegate%E5%8D%8F%E8%AE%AE%E4%BC%A0%E5%80%BC/" class="post-title-link" itemprop="url">Swift用Delegate协议传值</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-09-16 13:49:59 / 修改时间：14:49:00" itemprop="dateCreated datePublished" datetime="2019-09-16T13:49:59+08:00">2019-09-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一道面试题："><a href="#一道面试题：" class="headerlink" title="一道面试题："></a>一道面试题：</h3><p>有两个scene，分别为Scene A和Scene B。Scene A上有一个UIButton（Button A）和一个UILable（Lable A）；Scene B上有一个UITextFiled（textFiled）。当单击Scene A上的Button A时，跳转到Scene B，在Scene B的textFiled上输入文字，单击键盘的“完成”按钮，返典型的场景之间的跳转和逆向传值问。</p>
<p><strong>采用Delegate模式，回到Scene A，并在Scene A的Lable A上显示刚才输入的内容。</strong></p>
<p>iOS提供了多种方法，来实现页面之间的数据传递：</p>
<ul>
<li><p>使用SharedApplication，定义一个类似全局的变量来传递</p>
</li>
<li><p>使用文件，或者使用NSUserdefault来传递</p>
</li>
<li><p>通过一个单例（SingleXX）的class来传递</p>
</li>
<li><p>通过Delegate来传递</p>
</li>
</ul>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/May-26-2021%2023-55-15.gif" alt="May-26-2021 23-55-15"></p>
<h4 id="SceneDelegate-swift"><a href="#SceneDelegate-swift" class="headerlink" title="SceneDelegate.swift"></a>SceneDelegate.swift</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class SceneDelegate: UIResponder, UIWindowSceneDelegate &#123;</span><br><span class="line"></span><br><span class="line">    var window: UIWindow?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) &#123;</span><br><span class="line"></span><br><span class="line">        guard let windowScene = (scene as? UIWindowScene) else &#123; return &#125;</span><br><span class="line">        window = UIWindow(windowScene: windowScene)</span><br><span class="line">        window = UIWindow(frame: UIScreen.main.bounds)</span><br><span class="line">        window?.windowScene = windowScene</span><br><span class="line">        let viewController = RootViewController()</span><br><span class="line">        window?.rootViewController = viewController</span><br><span class="line">        window?.makeKeyAndVisible()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="RootViewController-swift"><a href="#RootViewController-swift" class="headerlink" title="RootViewController.swift"></a>RootViewController.swift</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  RootViewController.swift</span><br><span class="line">//  Delegate</span><br><span class="line">//</span><br><span class="line">//  Created by 朱官亮 on 2021/5/26.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import UIKit</span><br><span class="line">//实现ModeViewControlDelegate协议</span><br><span class="line">class RootViewController: UIViewController,MdoeViewControlDelegate&#123;</span><br><span class="line">    var btn:UIButton?</span><br><span class="line">    var label:UILabel?</span><br><span class="line">    //实现协议中的方法</span><br><span class="line">    func changeLabel(neString newString:String)  &#123;</span><br><span class="line">        self.label!.text = newString</span><br><span class="line">    &#125;</span><br><span class="line">    @objc func btnOnClick()&#123;</span><br><span class="line">        print(&quot;Onclick&quot;)</span><br><span class="line">        </span><br><span class="line">        let modeView = ModeViewController()</span><br><span class="line">        //设置modeView中的代理为RootViewController自身</span><br><span class="line">        modeView.delegate=self</span><br><span class="line">        //跳转到ModelView</span><br><span class="line">        modeView.modalPresentationStyle = .fullScreen</span><br><span class="line">        self.present(modeView,animated: true , completion: &#123;</span><br><span class="line">                                    print(&quot;OK&quot;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">        self.view.backgroundColor = UIColor.gray</span><br><span class="line">        label = UILabel()</span><br><span class="line">        label!.frame = CGRect(x: 110, y: 200, width: 100, height: 20)</span><br><span class="line">        label!.backgroundColor = UIColor.white</span><br><span class="line">        label!.text = &quot;你好！&quot;</span><br><span class="line">        label!.textAlignment = .center</span><br><span class="line">        </span><br><span class="line">        btn = UIButton()</span><br><span class="line">        btn!.frame = CGRect(x: 110, y: 240, width: 100, height: 20)</span><br><span class="line">        btn!.backgroundColor = UIColor.green</span><br><span class="line">        btn!.setTitle(&quot;下一视图&quot;, for: .normal)</span><br><span class="line">        btn!.addTarget(self, action:#selector(RootViewController.btnOnClick), for: .touchUpInside)</span><br><span class="line">        self.view.addSubview(label!)</span><br><span class="line">        self.view.addSubview(btn!)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    override func didReceiveMemoryWarning() &#123;</span><br><span class="line">        super.didReceiveMemoryWarning()</span><br><span class="line">        // Dispose of any resources that can be recreated.</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="MdoeViewControler-swift"><a href="#MdoeViewControler-swift" class="headerlink" title="MdoeViewControler.swift"></a>MdoeViewControler.swift</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class ModeViewController: UIViewController &#123;</span><br><span class="line">    var textF:UITextField?</span><br><span class="line">    var delegate:MdoeViewControlDelegate?</span><br><span class="line"></span><br><span class="line">    //点击事件</span><br><span class="line">    @objc func btnOnClick()&#123;</span><br><span class="line">        let str = textF?.text</span><br><span class="line">        print(str as Any)</span><br><span class="line">        </span><br><span class="line">        // 调用代理函数 改变label值</span><br><span class="line">        self.delegate?.changeLabel(neString: str!)</span><br><span class="line">        //返回RootView</span><br><span class="line">        self.dismiss(animated: true, completion: nil)</span><br><span class="line">    &#125;</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        view.backgroundColor=UIColor.cyan</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        textF=UITextField()</span><br><span class="line">        textF!.frame=CGRect(x: 110,y: 200,width: 100,height: 20)</span><br><span class="line">        textF!.backgroundColor=UIColor.white</span><br><span class="line">        textF!.borderStyle = .roundedRect</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        let btn=UIButton(frame:CGRect(x: 110,y: 240,width: 100,height: 20))</span><br><span class="line">        btn.backgroundColor=UIColor.orange</span><br><span class="line">        btn.setTitle(&quot;返回上视图&quot;,for:.normal)</span><br><span class="line">        //绑定事件</span><br><span class="line">        btn.addTarget(self,action:#selector(ModeViewController.btnOnClick),for: UIControl.Event.touchUpInside)</span><br><span class="line">        </span><br><span class="line">        self.view.addSubview(btn)</span><br><span class="line">        self.view.addSubview(textF!)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        // Do any additional setup after loading the view.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Protocol-swift"><a href="#Protocol-swift" class="headerlink" title="Protocol.swift"></a>Protocol.swift</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line">//协议定义要实现的方法</span><br><span class="line">protocol MdoeViewControlDelegate &#123;</span><br><span class="line">    func changeLabel(neString:String)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/16/%E6%A8%A1%E4%BB%BF%E5%BE%AE%E5%8D%9A%E9%A1%B9%E7%9B%AE%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/16/%E6%A8%A1%E4%BB%BF%E5%BE%AE%E5%8D%9A%E9%A1%B9%E7%9B%AE%E4%B8%80/" class="post-title-link" itemprop="url">模仿微博项目一</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-08-16 13:49:59 / 修改时间：14:49:00" itemprop="dateCreated datePublished" datetime="2019-08-16T13:49:59+08:00">2019-08-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="项目架构如下："><a href="#项目架构如下：" class="headerlink" title="项目架构如下："></a>项目架构如下：</h2><h2 id><a href="#" class="headerlink" title></a><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/IMG_0985.JPG" alt="IMG_0985"></h2><h2 id="创建项目诸葛微博，导入启动图片，设置应用名诸葛微博"><a href="#创建项目诸葛微博，导入启动图片，设置应用名诸葛微博" class="headerlink" title="创建项目诸葛微博，导入启动图片，设置应用名诸葛微博"></a>创建项目诸葛微博，导入启动图片，设置应用名诸葛微博</h2><h3 id="一般启动图片隐藏状态栏我们需要在info-plist文件里面增加一个键值对"><a href="#一般启动图片隐藏状态栏我们需要在info-plist文件里面增加一个键值对" class="headerlink" title="一般启动图片隐藏状态栏我们需要在info.plist文件里面增加一个键值对"></a>一般启动图片隐藏状态栏我们需要在info.plist文件里面增加一个键值对</h3><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210518132725402.png" alt="image-20210518132725402" style="zoom:50%;">

<p>运行程序，正常现实如下</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210518134021835.png" alt="image-20210518134021835" style="zoom: 67%;">

<h2 id="设置项目的结构目录"><a href="#设置项目的结构目录" class="headerlink" title="设置项目的结构目录"></a>设置项目的结构目录</h2><h3 id="微博项目的主目录是CIasses，它用于存放所有的类文件，根据MVVM的特点，该文件夹包含4个子文件夹，分别是View、ViewModeI、ModeI、TooIs。"><a href="#微博项目的主目录是CIasses，它用于存放所有的类文件，根据MVVM的特点，该文件夹包含4个子文件夹，分别是View、ViewModeI、ModeI、TooIs。" class="headerlink" title="微博项目的主目录是CIasses，它用于存放所有的类文件，根据MVVM的特点，该文件夹包含4个子文件夹，分别是View、ViewModeI、ModeI、TooIs。"></a>微博项目的主目录是CIasses，它用于存放所有的类文件，根据MVVM的特点，该文件夹包含4个子文件夹，分别是View、ViewModeI、ModeI、TooIs。</h3><p><img src="/Users/zhuguanliang/Downloads/IMG_0986.JPG" alt="IMG_0986"></p>
<h3 id="在View目录下，还需要创建一些子目录，这些子目录的相关说明如图。"><a href="#在View目录下，还需要创建一些子目录，这些子目录的相关说明如图。" class="headerlink" title="在View目录下，还需要创建一些子目录，这些子目录的相关说明如图。"></a>在View目录下，还需要创建一些子目录，这些子目录的相关说明如图。</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/IMG_0987.JPG" alt="IMG_0987"></p>
<h2 id="创建各个控制器的模板文件"><a href="#创建各个控制器的模板文件" class="headerlink" title="创建各个控制器的模板文件"></a>创建各个控制器的模板文件</h2><p>底下四个界面都是以表格显示的，因此要使用表视图控制器（UITabIeViewControIIer）</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/IMG_0988.JPG" alt="IMG_0988"></p>
<p>创建好的文件目录结构：</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210518143347326.png" alt="image-20210518143347326" style="zoom:50%;">

<p>删除ViewControIIer.swift文件，在AppDeIegate.swift文件中将标签控制器改为启动控制器，修改方式如下所示。</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210518144057394.png" alt="image-20210518144057394"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var window: UIWindow?</span><br><span class="line"></span><br><span class="line">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123;</span><br><span class="line">    </span><br><span class="line">    window?.rootViewController = MainViewController()</span><br><span class="line">    return true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删掉工程中main.storyboard ,删除plist文件中对应的键值外，还要删除其他的。具体如下</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/20200918164518418.png" alt="20200918164518418"></p>
<p>删除SceneDelegate.storyboard然后删除plist中Application Scene manifest。这个是iOS13后，在之前AppDelegate的基础上多出了一个SceneDelegate，会将AppDelegate里的lifecycle的那些代理方法转交给SceneDelegate</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/20200918164817835.png" alt="20200918164817835"></p>
<h2 id="导入TabBar图片，设置底部导航条"><a href="#导入TabBar图片，设置底部导航条" class="headerlink" title="导入TabBar图片，设置底部导航条"></a>导入TabBar图片，设置底部导航条</h2><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519022109532.png" alt="image-20210519022109532" style="zoom: 67%;">

<h3 id="在MainViewControIIer-swift文件中，给该类增加新的方法，用于添加4个控制器。"><a href="#在MainViewControIIer-swift文件中，给该类增加新的方法，用于添加4个控制器。" class="headerlink" title="在MainViewControIIer.swift文件中，给该类增加新的方法，用于添加4个控制器。"></a>在MainViewControIIer.swift文件中，给该类增加新的方法，用于添加4个控制器。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class MainViewController: UITabBarController &#123;</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">        // 使用kvc 完成只读属性赋值</span><br><span class="line">        setValue(tabBar, forKey: &quot;tabBar&quot;)</span><br><span class="line">        </span><br><span class="line">        addChildViewController(childController: HomeViewController(), title: &quot;首页&quot;, imgName: &quot;tabbar_home&quot;)</span><br><span class="line">        addChildViewController(childController: MessageViewController(), title: &quot;消息&quot;, imgName: &quot;tabbar_message_center&quot;)</span><br><span class="line">        addChildViewController(childController: DiscoverViewController(), title: &quot;发现&quot;, imgName: &quot;tabbar_discover&quot;)</span><br><span class="line">        addChildViewController(childController: ProfileViewController(), title: &quot;我&quot;, imgName: &quot;tabbar_profile&quot;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    /// 添加字控制器公共方法</span><br><span class="line">    ///</span><br><span class="line">    /// - Parameters:</span><br><span class="line">    ///   - childController: 字控制器</span><br><span class="line">    ///   - title: 名字</span><br><span class="line">    ///   - imgName: 图片名</span><br><span class="line">    func addChildViewController(childController: UIViewController, title: String, imgName: String) &#123;</span><br><span class="line"></span><br><span class="line">        // 设置title</span><br><span class="line">        childController.navigationItem.title = title</span><br><span class="line">        childController.tabBarItem.title = title</span><br><span class="line">        // 选中的颜色</span><br><span class="line">        childController.tabBarItem.setTitleTextAttributes([NSAttributedString.Key.foregroundColor : UIColor.orange], for: UIControl.State.selected)</span><br><span class="line">        </span><br><span class="line">        // 设置image</span><br><span class="line">        childController.tabBarItem.image = UIImage(named: imgName)?.withRenderingMode(UIImage.RenderingMode.alwaysOriginal)</span><br><span class="line">        // 选中</span><br><span class="line">        // .withRenderingMode(UIImageRenderingMode.alwaysOriginal) 图片渲染</span><br><span class="line">        childController.tabBarItem.selectedImage = UIImage(named: &quot;\(imgName)_selected&quot;)?.withRenderingMode(UIImage.RenderingMode.alwaysOriginal)</span><br><span class="line">        </span><br><span class="line">        // 导航控制器</span><br><span class="line">        let nav = UINavigationController(rootViewController: childController)</span><br><span class="line">        </span><br><span class="line">        // 添加子控制器</span><br><span class="line">        addChild(nav)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加撰写按钮，在main文件下新建TabBar-swift继承自UITabBar"><a href="#添加撰写按钮，在main文件下新建TabBar-swift继承自UITabBar" class="headerlink" title="添加撰写按钮，在main文件下新建TabBar.swift继承自UITabBar"></a>添加撰写按钮，在main文件下新建TabBar.swift继承自UITabBar</h2><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519023102895.png" alt="image-20210519023102895" style="zoom:67%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TabBar: UITabBar &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        setupUI()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder aDecoder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    // 设置视图</span><br><span class="line">    private func setupUI()&#123;</span><br><span class="line">        addSubview(composeButton)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func layoutSubviews() &#123;</span><br><span class="line">        super.layoutSubviews()</span><br><span class="line">        // 重写设置UITabBarButton的宽度</span><br><span class="line">        let w = frame.width * 0.2</span><br><span class="line">        // 记录遍历到第几个的标识</span><br><span class="line">        var index: CGFloat = 0</span><br><span class="line">        // 遍历子控件UITabBarButton</span><br><span class="line">        for view in subviews&#123;</span><br><span class="line">            </span><br><span class="line">            // 判断是否是UITabBarButton(系统私有的)</span><br><span class="line">            // NSClassFromString 通过字符串转出得到对应的class</span><br><span class="line">            if view.isKind(of: NSClassFromString(&quot;UITabBarButton&quot;)!) &#123;</span><br><span class="line">                print(view)</span><br><span class="line">                // 宽度</span><br><span class="line">                view.frame.size.width = w</span><br><span class="line">                // x轴</span><br><span class="line">                view.frame.origin.x = w * index</span><br><span class="line">                </span><br><span class="line">                // index 递增</span><br><span class="line">                index += 1</span><br><span class="line">                </span><br><span class="line">                // 如果等于2 需要再加一 给撰写按钮.留位置</span><br><span class="line">                if index == 2 &#123;</span><br><span class="line">                    index += 1</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        // composeButton</span><br><span class="line">        composeButton.center.x = frame.size.width * 0.5</span><br><span class="line">        composeButton.center.y = frame.size.height * 0.35</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 懒加载控件</span><br><span class="line">    // 撰写按钮</span><br><span class="line">    private lazy var composeButton: UIButton = &#123;</span><br><span class="line">        let btn = UIButton()</span><br><span class="line">        // image 和背景图片</span><br><span class="line">        btn.setBackgroundImage(UIImage(named:&quot;tabbar_compose_button_highlighted&quot;), for: UIControl.State.highlighted)</span><br><span class="line">        btn.setBackgroundImage(UIImage(named:&quot;tabbar_compose_button&quot;), for: UIControl.State.normal)</span><br><span class="line">        btn.setImage(UIImage(named:&quot;tabbar_compose_icon_add_highlighted&quot;), for: UIControl.State.highlighted)</span><br><span class="line">        btn.setImage(UIImage(named:&quot;tabbar_compose_icon_add&quot;), for: UIControl.State.normal)</span><br><span class="line">        btn.sizeToFit()</span><br><span class="line">        return btn</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="同时在MainViewControIIer-swift，添加上去"><a href="#同时在MainViewControIIer-swift，添加上去" class="headerlink" title="同时在MainViewControIIer.swift，添加上去"></a>同时在MainViewControIIer.swift，添加上去</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519022956363.png" alt="image-20210519022956363"></p>
<h3 id="在Tools新建Extensions文件，添加EXT-UIBarButtonItem-swift"><a href="#在Tools新建Extensions文件，添加EXT-UIBarButtonItem-swift" class="headerlink" title="在Tools新建Extensions文件，添加EXT+UIBarButtonItem.swift"></a>在Tools新建Extensions文件，添加EXT+UIBarButtonItem.swift</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extension UIBarButtonItem &#123;</span><br><span class="line">    </span><br><span class="line">    // 图片名 名字  target action</span><br><span class="line">    convenience init(imgName: String?, title: String?, target: Any?, action: Selector)&#123;</span><br><span class="line"></span><br><span class="line">        // 实例化一个按钮</span><br><span class="line">        let button = UIButton()</span><br><span class="line">        // 监听事件</span><br><span class="line">        button.addTarget(target, action: action, for: UIControl.Event.touchUpInside)</span><br><span class="line">        </span><br><span class="line">        if let img = imgName &#123;</span><br><span class="line">            // 图片</span><br><span class="line">            button.setImage(UIImage(named:img), for: UIControl.State.normal)</span><br><span class="line">            button.setImage(UIImage(named:&quot;\(img)_highlighted&quot;), for: UIControl.State.highlighted)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if let tit = title &#123;</span><br><span class="line">            // 文字</span><br><span class="line">            button.setTitle(tit, for: UIControl.State.normal)</span><br><span class="line">            button.titleLabel?.font = UIFont.systemFont(ofSize: 14)</span><br><span class="line">            button.setTitleColor(UIColor.darkGray, for: UIControl.State.normal)</span><br><span class="line">            button.setTitleColor(UIColor.orange, for: UIControl.State.highlighted)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        button.sizeToFit()</span><br><span class="line">        </span><br><span class="line">        // 调用指定构造函数完成实例化</span><br><span class="line">        self.init(customView: button)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="访客视图"><a href="#访客视图" class="headerlink" title="访客视图"></a>访客视图</h2><h3 id="添加表视图控制器基类"><a href="#添加表视图控制器基类" class="headerlink" title="添加表视图控制器基类"></a>添加表视图控制器基类</h3><p>上一章搭建项目框架时，添加了四个子控制器，这些控制器都继承自UITabIeView ControIIer。由于这些控制器管理的页面有共同的地方，所以我们可以新建一个表格视图控制器的基类VisitorTabIeViewControIIer，该基类增加用户登录标记，根据用户登录标记判断是否加载默认视图，具体步骤如下。</p>
<p>（1）在Main目录下创建一个新的文件夹Visitor用来放置访客视图的类。</p>
<p>（2）在Visitor文件夹下创建一个继承自UITabIeViewControIIer的基类VisitorTabIeView ControIIer，如图所示。</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519122738098.png" alt="image-20210519122738098"></p>
<p><strong>同时将前面4个视图HomeViewController.swift、MessageTabIeViewControIIer.swift、DiscoverTabIe ViewControIIer.swift和ProfiIeTabIeViewControIIer.swift这几个类的父类修改为VisitorTabIe ViewControIIer。</strong></p>
<h3 id="新建的访客视图类VisitorTabIeViewControIIer中，实现根据用户标记切换根视图的代码"><a href="#新建的访客视图类VisitorTabIeViewControIIer中，实现根据用户标记切换根视图的代码" class="headerlink" title="新建的访客视图类VisitorTabIeViewControIIer中，实现根据用户标记切换根视图的代码"></a>新建的访客视图类VisitorTabIeViewControIIer中，实现根据用户标记切换根视图的代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class VisitorTableViewController: UITableViewController &#123;</span><br><span class="line">    </span><br><span class="line">    //用户登录标记</span><br><span class="line">    private var userLogon = false</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">        userLogon ? super.loadView() : setupVisitorView()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    //设置访客视图</span><br><span class="line">    private func setupVisitorView ()&#123;</span><br><span class="line">        view = UIView ()</span><br><span class="line">        view.backgroundColor = UIColor.orange</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>创建访客视图，导入访客视图的图片资源Visitor文件夹拖入Assets.xcassets文件目录中</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519123405635.png" alt="image-20210519123405635"></p>
<p>在文件夹CIasses的子文件夹Visitor中新建一个继承自UIView的类VisitorView，创建好的文件如图</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519123521547.png" alt="image-20210519123521547" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">class VisitorView: UIView &#123;</span><br><span class="line">    /// 图标，使用 image: 构造函数创建的 imageView 默认就是 image 的大小</span><br><span class="line">    private lazy var iconView: UIImageView = UIImageView (image: UIImage (named: &quot;visitordiscover_feed_image_smallicon&quot;))</span><br><span class="line">    ///// 小房子</span><br><span class="line">    private lazy var homeIconView: UIImageView = UIImageView (image: UIImage (named: &quot;visitordiscover_feed_image_house&quot;))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        setupUI()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // initWithCoder - 使用 StoryBoard &amp; XIB 开发加载的函数</span><br><span class="line">    required init ? (coder aDecoder: NSCoder) &#123;</span><br><span class="line">        super.init(coder:aDecoder)</span><br><span class="line">        setupUI()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension VisitorView&#123;</span><br><span class="line">    //设置界面</span><br><span class="line">    private func setupUI() &#123;</span><br><span class="line">        addSubview(iconView)</span><br><span class="line">        addSubview(homeIconView)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519130734794.png" alt="image-20210519130734794" style="zoom: 25%;">

<h3 id="使用自动布局设置图片的位置"><a href="#使用自动布局设置图片的位置" class="headerlink" title="使用自动布局设置图片的位置"></a>使用自动布局设置图片的位置</h3><h3 id="-1"><a href="#-1" class="headerlink" title></a><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519131849026.png" alt="image-20210519131849026" style="zoom:50%;"></h3><p>我们已经将图片添加到了访客视图上，但是图片都堆在了左上角，所以我们需要对图片添加约束。使用纯代码设置自动布局时，首先需要把transIatesAutoresizingMaskInto Constraints属性设置为faIse，表示支持使用自动布局来设置控件位置。通过循环的方式，在setupUI（）方法中将subviews中的控件的transIatesAutoresizingMaskIntoConstraints属性设置为faIse，代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for v in subviews &#123;</span><br><span class="line">    v.translatesAutoresizingMaskIntoConstraints = false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在下方添加自动布局代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//图标</span><br><span class="line">  addConstraint(NSLayoutConstraint (item: iconView, attribute:</span><br><span class="line">                                      .centerX, relatedBy: .equal, toItem: self, attribute: .centerX,</span><br><span class="line">                                      multiplier: 1.0, constant: 0))</span><br><span class="line">  </span><br><span class="line">  addConstraint(NSLayoutConstraint (item: iconView, attribute:</span><br><span class="line">                                      .centerY, relatedBy: .equal, toItem: self, attribute: .centerY,</span><br><span class="line">                                      multiplier: 1.0, constant: -60))</span><br><span class="line">  //房子</span><br><span class="line">  addConstraint(NSLayoutConstraint (item: homeIconView, attribute:</span><br><span class="line">                                      .centerX, relatedBy: .equal, toItem: self, attribute: .centerX,</span><br><span class="line">                                      multiplier: 1.0, constant: 0))</span><br><span class="line">  </span><br><span class="line">  addConstraint(NSLayoutConstraint (item: homeIconView, attribute:</span><br><span class="line">                                      .centerY, relatedBy: .equal, toItem: self, attribute: .centerY,</span><br><span class="line">                                      multiplier: 1.0, constant: -60))</span><br></pre></td></tr></table></figure>

<h3 id="完成图片的添加后，继续在VisitorView类中添加表示消息文字的懒加载控件IabeI"><a href="#完成图片的添加后，继续在VisitorView类中添加表示消息文字的懒加载控件IabeI" class="headerlink" title="完成图片的添加后，继续在VisitorView类中添加表示消息文字的懒加载控件IabeI"></a>完成图片的添加后，继续在VisitorView类中添加表示消息文字的懒加载控件IabeI</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519132406319.png" alt="image-20210519132406319"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private lazy var messageLabel: UILabel = &#123;</span><br><span class="line">    let label = UILabel()</span><br><span class="line">    label.text = &quot;关注一些人，回这里看看有什么惊喜&quot;</span><br><span class="line">    // 界面设计上，避免使用纯黑色</span><br><span class="line">    //设置label文字颜色</span><br><span class="line">    label.textColor = UIColor.darkGray</span><br><span class="line">    //设置label字体大小</span><br><span class="line">    </span><br><span class="line">    //设置label字体大小</span><br><span class="line">    label.font = UIFont.systemFont(ofSize: 14)</span><br><span class="line">    //label文字不限制行数</span><br><span class="line">    label.numberOfLines = 0</span><br><span class="line">    //设置文字的对其方式</span><br><span class="line">    label.textAlignment = NSTextAlignment.center</span><br><span class="line">    return label</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<h3 id="在设置界面方法setupUI（）中，首先通过addSubview方法添加messageLabeI控件，具体代码如下。"><a href="#在设置界面方法setupUI（）中，首先通过addSubview方法添加messageLabeI控件，具体代码如下。" class="headerlink" title="在设置界面方法setupUI（）中，首先通过addSubview方法添加messageLabeI控件，具体代码如下。"></a>在设置界面方法setupUI（）中，首先通过addSubview方法添加messageLabeI控件，具体代码如下。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addSubview(messageLabel)</span><br></pre></td></tr></table></figure>

<h3 id="另外，还需要为messageLabeI添加约束，代码如下。"><a href="#另外，还需要为messageLabeI添加约束，代码如下。" class="headerlink" title="另外，还需要为messageLabeI添加约束，代码如下。"></a>另外，还需要为messageLabeI添加约束，代码如下。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">addConstraint(NSLayoutConstraint(item: messageLabel, attribute:</span><br><span class="line">.centerX, relatedBy: .equal, toItem: iconView, attribute: .centerX,</span><br><span class="line">multiplier: 1.0, constant: 0))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: messageLabel, attribute:</span><br><span class="line">                                    .top, relatedBy: .equal, toItem: iconView, attribute: .bottom,</span><br><span class="line">multiplier: 1.0, constant: 16))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: messageLabel, attribute:</span><br><span class="line">                                    .width, relatedBy: .equal, toItem: nil, attribute: .notAnAttribute,</span><br><span class="line">multiplier: 1.0, constant: 224))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: messageLabel, attribute:</span><br><span class="line">                                    .height, relatedBy: .equal, toItem: nil, attribute: .notAnAttribute,</span><br><span class="line">multiplier: 1.0, constant: 36))</span><br></pre></td></tr></table></figure>



<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519132929023.png" alt="image-20210519132929023" style="zoom:50%;">

<h3 id="添加其他控件"><a href="#添加其他控件" class="headerlink" title="添加其他控件"></a>添加其他控件</h3><p>接下来，在消息文字IabeI下面添加“登录”和“注册”按钮，代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/// 注册按钮</span><br><span class="line">private lazy var registerButton: UIButton = &#123;</span><br><span class="line">let button = UIButton()</span><br><span class="line">//设置普通状态下按钮文字</span><br><span class="line">    button.setTitle(&quot;注册&quot;, for: UIControl.State.normal)</span><br><span class="line">//设置普通状态下按钮文字颜色</span><br><span class="line">    button.setTitleColor(UIColor.orange, for: UIControl.State.normal)</span><br><span class="line">//设置普通状态下按钮背景图片</span><br><span class="line">    button.setBackgroundImage(UIImage(named: &quot;common_button_white_disable&quot;),</span><br><span class="line">                              for: UIControl.State.normal)</span><br><span class="line">return button</span><br><span class="line">&#125;()</span><br><span class="line">/// 登录按钮</span><br><span class="line">private lazy var loginButton: UIButton = &#123;</span><br><span class="line">let button = UIButton()</span><br><span class="line">    button.setTitle(&quot;登录&quot;, for: UIControl.State.normal)</span><br><span class="line">    button.setTitleColor(UIColor.orange,</span><br><span class="line">                         for: UIControl.State.normal)</span><br><span class="line">    button.setBackgroundImage(UIImage(named: &quot;common_button_white_disable&quot;),</span><br><span class="line">                              for: UIControl.State.normal)</span><br><span class="line">return button</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<p>同样在设置界面方法setupUI()中添加控件,代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addSubview(registerButton)</span><br><span class="line">addSubview(loginButton)</span><br></pre></td></tr></table></figure>

<p>同样在设置界面方法setupUI()中添加控件,代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">addSubview(registerButton)</span><br><span class="line">addSubview(loginButton)</span><br><span class="line">在setupUI()中为注册和登录添加约束,代码如下。</span><br><span class="line">// 4＞ 注册按钮</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton, attribute: .Left,</span><br><span class="line">relatedBy: .equal, toItem: messageLabel, attribute: .Left,</span><br><span class="line">multiplier: 1.0, constant: 0))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton,</span><br><span class="line">attribute: .Top, relatedBy: .equal, toItem: messageLabel, attribute: .Bottom,</span><br><span class="line">multiplier: 1.0, constant: 16))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton,</span><br></pre></td></tr></table></figure>

<p>在setupUI（）中为注册和登录添加约束，代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">// 4＞ 注册按钮</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton, attribute: .left,</span><br><span class="line">relatedBy: .equal, toItem: messageLabel, attribute: .left,</span><br><span class="line">multiplier: 1.0, constant: 0))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton,</span><br><span class="line">attribute: .top, relatedBy: .equal, toItem: messageLabel, attribute: .bottom,</span><br><span class="line">multiplier: 1.0, constant: 16))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton,</span><br><span class="line">                                 attribute: .width, relatedBy: .equal, toItem: nil, attribute: .notAnAttribute,</span><br><span class="line">multiplier: 1.0, constant: 100))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: registerButton,</span><br><span class="line">                                 attribute: .height, relatedBy: .equal, toItem: nil, attribute: .notAnAttribute,</span><br><span class="line">multiplier: 1.0, constant: 36))</span><br><span class="line"></span><br><span class="line">// 5＞ 登录按钮</span><br><span class="line">addConstraint(NSLayoutConstraint(item: loginButton,</span><br><span class="line">                                 attribute: .right, relatedBy: .equal, toItem: messageLabel, attribute: .right,</span><br><span class="line">multiplier: 1.0, constant: 0))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: loginButton,</span><br><span class="line">attribute: .top, relatedBy: .equal, toItem: messageLabel, attribute: .bottom,</span><br><span class="line">multiplier: 1.0, constant: 16))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: loginButton,</span><br><span class="line">                                 attribute: .width, relatedBy: .equal, toItem: nil, attribute: .notAnAttribute,</span><br><span class="line">multiplier: 1.0, constant: 100))</span><br><span class="line">addConstraint(NSLayoutConstraint(item: loginButton,</span><br><span class="line">                                 attribute: .height, relatedBy: .equal, toItem: nil, attribute: .notAnAttribute,</span><br><span class="line">multiplier: 1.0, constant: 36))</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519135513665.png" alt="image-20210519135513665" style="zoom:50%;">

<h3 id="添加遮罩视图，并使用VFL布局位置"><a href="#添加遮罩视图，并使用VFL布局位置" class="headerlink" title="添加遮罩视图，并使用VFL布局位置"></a>添加遮罩视图，并使用VFL布局位置</h3><p>先在懒加载控件处添加遮罩图片控件，代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/// 遮罩图像</span><br><span class="line"> private lazy var maskIconView: UIImageView = UIImageView (image: UIImage (named: &quot;visitordiscover_feed_mask_smallicon&quot;))</span><br></pre></td></tr></table></figure>

<p>接下来在setupUI（）方法中添加遮罩视图控件，需要注意的是，由于添加视图控件时，后添加的视图会位于之前添加的视图之上，这里，我们需要将添加遮罩视图的代码放在添加homeIconView和iconView之间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addSubview(maskIconView)</span><br></pre></td></tr></table></figure>

<h3 id="下面使用addConstraints为遮罩视图添加约束，代码如下。"><a href="#下面使用addConstraints为遮罩视图添加约束，代码如下。" class="headerlink" title="下面使用addConstraints为遮罩视图添加约束，代码如下。"></a>下面使用addConstraints为遮罩视图添加约束，代码如下。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//6.遮罩图像</span><br><span class="line">//view ： 定义VFL中的控件名称和实际名称的映射关系</span><br><span class="line">//metrics   :定义 VFL 中（） 指定常数映射关系</span><br><span class="line">let viewDict = [&quot;maskIconView&quot;: maskIconView,</span><br><span class="line">                &quot;registerButton&quot;: registerButton]</span><br><span class="line">let metrics =  [&quot;spacing&quot;: -35]</span><br><span class="line">addConstraints(NSLayoutConstraint.constraints(</span><br><span class="line">    withVisualFormat: &quot;H:|-0-[maskIconView]-0-|&quot;,</span><br><span class="line">    options: [],</span><br><span class="line">    metrics: nil,</span><br><span class="line">    views: viewDict))</span><br><span class="line">addConstraints(NSLayoutConstraint.constraints(</span><br><span class="line">    withVisualFormat: &quot;V:|-0-[maskIconView]-(spacing)-[registerButton]&quot;,</span><br><span class="line">    options: [],</span><br><span class="line">    metrics: metrics,</span><br><span class="line">    views: viewDict))</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519142012349.png" alt="image-20210519142012349" style="zoom:50%;">

<p>在遮罩视图下方会有白色的空白地带，如果调整约束为全屏，会导致遮罩图片无法遮挡圆圈的下半部分，那么在这里，我们可以通过修改访客视图的背景颜色用来达到同样的效果。在遮罩视图约束下面添加修改背景颜色的代码，代码如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 设置背景颜色 - 灰度图 R = G = B，在 UI 元素中，大多数都使用灰度图，或者纯色图（安全色）</span><br><span class="line">backgroundColor = UIColor.cz_color(withHex: 0xEDEDED)</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519142555268.png" alt="image-20210519142555268" style="zoom:50%;">

<h3 id="根据前面描述的界面得知，各个控制器的图标和文字各不相同，所以我们需要设置视图信息，在VisitorView类中新建一个设置视图信息的方法setupInfo（），具体代码如下。"><a href="#根据前面描述的界面得知，各个控制器的图标和文字各不相同，所以我们需要设置视图信息，在VisitorView类中新建一个设置视图信息的方法setupInfo（），具体代码如下。" class="headerlink" title="根据前面描述的界面得知，各个控制器的图标和文字各不相同，所以我们需要设置视图信息，在VisitorView类中新建一个设置视图信息的方法setupInfo（），具体代码如下。"></a>根据前面描述的界面得知，各个控制器的图标和文字各不相同，所以我们需要设置视图信息，在VisitorView类中新建一个设置视图信息的方法setupInfo（），具体代码如下。</h3><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519144041393.png" alt="image-20210519144041393" style="zoom: 50%;">

<p>可以通过imageName参数传入每个控制需要显示的图片，通过titIe传入每个控制器需要显示的消息文字。设置视图的方法完成之后，我们可以看到，<strong>setupInfo是准备在VisitorView中的，而VisitorView则是在VisitorTabIeViewControIIer中定义的，所以在别的控制器中无法拿到VisitorView</strong>，那么，接下来修改VisitorTabIeViewControIIer中的代码，修改后的代码如下。</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519144916442.png" alt="image-20210519144916442" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//访客视图</span><br><span class="line">var visitorView: VisitorView?</span><br><span class="line"></span><br><span class="line">        //替换根视图</span><br><span class="line">    visitorView = VisitorView ()</span><br><span class="line">    view = visitorView</span><br></pre></td></tr></table></figure>

<p>上面的代码中，首先声明一个访客视图，接下来在接收VisitorView，最后在将view替换成visitorView。接下来分别在其他控制器中访问VisitorView的setupInfo方法设置各个控制器的图片和消息文字。四个控制器中的代码分别如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class HomeViewController: VisitorTableViewController &#123;</span><br><span class="line"></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        visitorView?.setupInfo(imageName: nil, title: &quot;关注一些人,回这里看看有什么惊喜&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class MessageViewController: VisitorTableViewController &#123;</span><br><span class="line"></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        visitorView?.setupInfo(imageName: &quot;visitordiscover_image_message&quot;, title: &quot;登录后,别人评论你的微博,发给你的消息,都会在这里收到通知&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class DiscoverViewController: VisitorTableViewController &#123;</span><br><span class="line"></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        visitorView?.setupInfo(imageName: &quot;visitordiscover_image_message&quot;, title: &quot;登录后,最新、最热微博尽在掌握,不再会与实事潮流擦肩而过&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class ProfileViewController: VisitorTableViewController &#123;</span><br><span class="line"></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        visitorView?.setupInfo(imageName: &quot;visitordiscover_image_profile&quot;, title: &quot;登录后,你的微博、相册、个人资料会显示在这里,展示给别人&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/IMG_1002.JPG" alt="IMG_1002" style="zoom: 67%;">

<p>虽然图片已经设置完成，但是后面的界面中仍然显示了小房子图片和遮罩图像，这是因为在VisitorView中默认添加了小房子图片和遮罩图像，所以在这里如果不是首页，可以将小房子图片隐藏，并将遮罩图像移动到底层，在设置视图信息的方法setupInfo（）中，在guard Iet后面添加代码，代码如下。</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519150515444.png" alt="image-20210519150515444" style="zoom:50%;">

<p><img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/IMG_10022.JPG" alt="IMG_10022"></p>
<h3 id="为首页转轮图片设置动画"><a href="#为首页转轮图片设置动画" class="headerlink" title="为首页转轮图片设置动画"></a>为首页转轮图片设置动画</h3><p>转轮图片会一直转动，这种转动的效果是通过动画来实现的。接下来，在VisitorView类中声明一个开启首页转轮动画的方法startAnim（），代码如下</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519151157572.png" alt="image-20210519151157572" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//旋转图标动画(首页)</span><br><span class="line">private func startAnimation() &#123;</span><br><span class="line">    let anim = CABasicAnimation(keyPath: &quot;transform.rotation&quot;)</span><br><span class="line">    </span><br><span class="line">    anim.toValue = 2 * Double.pi</span><br><span class="line">    anim.repeatCount = MAXFLOAT</span><br><span class="line">    anim.duration = 15</span><br><span class="line">    </span><br><span class="line">    //动画完成不删除，如果 iconView 被释放，动画一定会被销毁</span><br><span class="line">    //属性在设置连续播放动画非常有用</span><br><span class="line">    anim.isRemovedOnCompletion = false</span><br><span class="line">    </span><br><span class="line">    //将动画添加到图层</span><br><span class="line">    iconView.layer.add(anim, forKey: nil)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来在setupInfo方法的guard Iet中return之前调用转轮动画的方法，代码如下。</p>
<img src="https://gitee.com/zhu565615430/images/raw/master/CBcityimas/image-20210519151700070.png" alt="image-20210519151700070" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//播插动画</span><br><span class="line">startAnimation()</span><br></pre></td></tr></table></figure>

<p>运行发现有动画了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/22/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%889%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/22/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%889%EF%BC%89/" class="post-title-link" itemprop="url">oc版本的新闻App（9）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-22 12:49:00" itemprop="dateCreated datePublished" datetime="2019-04-22T12:49:00+08:00">2019-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-01 14:49:00" itemprop="dateModified" datetime="2021-02-01T14:49:00+08:00">2021-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Crash的上报技术方案对比"><a href="#Crash的上报技术方案对比" class="headerlink" title="Crash的上报技术方案对比"></a>Crash的上报技术方案对比</h1><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117172131297.png" alt="image-20210117172131297"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTStaicTest.h&quot;</span><br><span class="line">#include &lt;execinfo.h&gt;</span><br><span class="line">#import &lt;TencentOpenAPI/TencentOAuth.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117172203997.png" alt="image-20210117172203997"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    [self _caughtException];</span><br><span class="line">    [@[].mutableCopy addObject:nil];</span><br><span class="line">//    static库的集成</span><br><span class="line">//    [[GTStaicTest alloc] init];</span><br><span class="line">    </span><br><span class="line">    //framework的集成</span><br><span class="line">    //[[GTFrameworkTest alloc] init];</span><br><span class="line">    </span><br><span class="line">    //测试crash收集</span><br><span class="line">    //[self _caughtException];</span><br><span class="line">    //[@[].mutableCopy addObject:nil];</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117172257202.png" alt="image-20210117172257202"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - CRASH</span><br><span class="line"></span><br><span class="line">- (void)_caughtException&#123;</span><br><span class="line">    //NSexception</span><br><span class="line">    NSSetUncaughtExceptionHandler(HandleNSException);</span><br><span class="line">    </span><br><span class="line">    //signal</span><br><span class="line">    signal(SIGABRT, SignalExceptionHandler);</span><br><span class="line">    signal(SIGILL, SignalExceptionHandler);</span><br><span class="line">    signal(SIGSEGV, SignalExceptionHandler);</span><br><span class="line">    signal(SIGFPE, SignalExceptionHandler);</span><br><span class="line">    signal(SIGBUS, SignalExceptionHandler);</span><br><span class="line">    signal(SIGPIPE, SignalExceptionHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SignalExceptionHandler(int signal)&#123;</span><br><span class="line">    void* callstack[128];</span><br><span class="line">    int frames = backtrace(callstack, 128);</span><br><span class="line">    char **strs = backtrace_symbols(callstack, frames);</span><br><span class="line">    NSMutableArray *backtrace = [NSMutableArray arrayWithCapacity:frames];</span><br><span class="line">    for (int i = 0; i &lt; frames; i++) &#123;</span><br><span class="line">        [backtrace addObject:[NSString stringWithUTF8String:strs[i]]];</span><br><span class="line">    &#125;</span><br><span class="line">    free(strs);</span><br><span class="line">    //存储crash信息。</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void HandleNSException(NSException *exception)&#123;</span><br><span class="line">    __unused NSString *reason = [exception reason];</span><br><span class="line">    __unused NSString *name = [exception name];</span><br><span class="line">    //存储crash信息。</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="定位和请求位置权限"><a href="#定位和请求位置权限" class="headerlink" title="定位和请求位置权限"></a>定位和请求位置权限</h1><p>新建GTLocation(NSObject)</p>
<h2 id="完成了单例的类"><a href="#完成了单例的类" class="headerlink" title="完成了单例的类"></a>完成了单例的类</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514122910276.png" alt="image-20210514122910276"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTLocation.h&quot;</span><br><span class="line"></span><br><span class="line">@interface GTLocation()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTLocation</span><br><span class="line"></span><br><span class="line">+ (GTLocation *)locationManager&#123;</span><br><span class="line">    static GTLocation *location;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        location = [[GTLocation alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return location;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117182054304.png" alt="image-20210117182054304"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> App中统一的位置信息管理</span><br><span class="line"> */</span><br><span class="line">@interface GTLocation : NSObject</span><br><span class="line"></span><br><span class="line">+ (GTLocation *)locationManager;</span><br><span class="line"></span><br><span class="line">- (void)checkLocationAuthorization;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<h3 id="首次安装请求位置权限的获取"><a href="#首次安装请求位置权限的获取" class="headerlink" title="首次安装请求位置权限的获取"></a>首次安装请求位置权限的获取</h3><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117183431199.png" alt="image-20210117183431199" style="zoom:50%;">

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117182925438.png" alt="image-20210117182925438"></p>
<img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117185026565.png" alt="image-20210117185026565" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;CoreLocation/CoreLocation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTLocation()&lt;CLLocationManagerDelegate&gt;</span><br><span class="line">@property(nonatomic, strong, readwrite) CLLocationManager *manager;</span><br><span class="line"></span><br><span class="line">        self.manager = [[CLLocationManager alloc] init];</span><br><span class="line">        self.manager.delegate = self;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">//判断APP相应的状态</span><br><span class="line">- (void)checkLocationAuthorization&#123;</span><br><span class="line">    </span><br><span class="line">    //判断系统是否开启</span><br><span class="line">    if(![CLLocationManager locationServicesEnabled])&#123;</span><br><span class="line">        //引导弹窗</span><br><span class="line">        //</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if([CLLocationManager authorizationStatus] == kCLAuthorizationStatusNotDetermined)&#123;</span><br><span class="line">        [self.manager requestWhenInUseAuthorization];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - delegate</span><br><span class="line"></span><br><span class="line">- (void)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status&#123;</span><br><span class="line">    if (status == kCLAuthorizationStatusAuthorizedWhenInUse) &#123;</span><br><span class="line">        //</span><br><span class="line">        [self.manager startUpdatingLocation];</span><br><span class="line">        </span><br><span class="line">    &#125;else if (status == kCLAuthorizationStatusDenied)&#123;</span><br><span class="line">        //</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117185924011.png" alt="image-20210117185924011"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117185938825.png" alt="image-20210117185938825"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTLocation.h&quot;</span><br><span class="line"></span><br><span class="line">[[GTLocation locationManager] checkLocationAuthorization];</span><br></pre></td></tr></table></figure>

<h3 id="获取当前位置信息"><a href="#获取当前位置信息" class="headerlink" title="获取当前位置信息"></a><em>获取当前位置信息</em></h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514123220586.png" alt="image-20210514123220586"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (void)locationManager:(CLLocationManager *)manager</span><br><span class="line">     didUpdateLocations:(NSArray&lt;CLLocation *&gt; *)locations &#123;</span><br><span class="line">    </span><br><span class="line">    //地理信息</span><br><span class="line">    CLLocation *location = [locations firstObject];</span><br><span class="line">    </span><br><span class="line">    CLGeocoder *coder = [[CLGeocoder alloc] init];</span><br><span class="line">    </span><br><span class="line">    [coder reverseGeocodeLocation:location completionHandler:^(NSArray&lt;CLPlacemark *&gt; * _Nullable placemarks, NSError * _Nullable error) &#123;</span><br><span class="line">        //地标信息</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">     [self.manager stopUpdatingLocation];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h1><h2 id="新建单例GTNotification-NSObject"><a href="#新建单例GTNotification-NSObject" class="headerlink" title="新建单例GTNotification(NSObject)"></a>新建单例GTNotification(NSObject)</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224357716.png" alt="image-20210117224357716"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTNotification.h&quot;</span><br><span class="line">#import &lt;UserNotifications/UserNotifications.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTNotification ()&lt;UNUserNotificationCenterDelegate&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTNotification</span><br><span class="line">+ (GTNotification *)notificationManager&#123;</span><br><span class="line">    static GTNotification *manager;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manager = [[GTNotification alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)checkNotificationAuthorization&#123;</span><br><span class="line">    </span><br><span class="line">    UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">    center.delegate = self;</span><br><span class="line">    [center requestAuthorizationWithOptions:UNAuthorizationOptionBadge | UNAuthorizationOptionSound completionHandler:^(BOOL granted, NSError * _Nullable error) &#123;</span><br><span class="line">        NSLog(@&quot;&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224431147.png" alt="image-20210117224431147"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> APP 推送管理</span><br><span class="line"> */</span><br><span class="line">@interface GTNotification : NSObject</span><br><span class="line"></span><br><span class="line">+ (GTNotification *)notificationManager;</span><br><span class="line"></span><br><span class="line">- (void)checkNotificationAuthorization;//效验权限的方法</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224516134.png" alt="image-20210117224516134"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117224553185.png" alt="image-20210117224553185"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTNotification.h&quot;</span><br><span class="line"></span><br><span class="line">[[GTNotification notificationManager] checkNotificationAuthorization];</span><br></pre></td></tr></table></figure>

<h2 id="实现本地推送"><a href="#实现本地推送" class="headerlink" title="实现本地推送"></a>实现本地推送</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514123601280.png" alt="image-20210514123601280"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117231013306.png" alt="image-20210117231013306"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117231031479.png" alt="image-20210117231031479"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">if (granted) &#123;</span><br><span class="line">            //本地推送</span><br><span class="line">            [self _pushLocalNotification];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)_pushLocalNotification&#123;</span><br><span class="line">    </span><br><span class="line">    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];</span><br><span class="line">    content.badge = @(1);</span><br><span class="line">    content.title = @&quot;北京时间&quot;;</span><br><span class="line">    content.body = @&quot;这是一款iOS App&quot;;</span><br><span class="line">    content.sound = [UNNotificationSound defaultSound];</span><br><span class="line">    </span><br><span class="line">    UNTimeIntervalNotificationTrigger *trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:30.f repeats:NO];</span><br><span class="line">    </span><br><span class="line">    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:@&quot;_pushLocalNotification&quot; content:content trigger:trigger];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) &#123;</span><br><span class="line">        //</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">  2      </span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler&#123;</span><br><span class="line">    completionHandler(UNNotificationPresentationOptionBanner);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)(void))completionHandler &#123;</span><br><span class="line">    </span><br><span class="line">    //处理badge展示逻辑</span><br><span class="line">    //点击之后根据业务逻辑处理</span><br><span class="line">    //[UIApplication sharedApplication].applicationIconBadgeNumber = 100;</span><br><span class="line"></span><br><span class="line">    //处理业务逻辑</span><br><span class="line">    completionHandler();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/21/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%888%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/21/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%888%EF%BC%89/" class="post-title-link" itemprop="url">oc版本的新闻App（8）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-21 12:49:00" itemprop="dateCreated datePublished" datetime="2019-04-21T12:49:00+08:00">2019-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-01 14:49:00" itemprop="dateModified" datetime="2021-02-01T14:49:00+08:00">2021-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="登陆与分享的逻辑"><a href="#登陆与分享的逻辑" class="headerlink" title="登陆与分享的逻辑"></a>登陆与分享的逻辑</h2><img src="https://gitee.com/zhu565615430/images/raw/master/imas/IMG_641F8B4270E9-1.jpeg" alt="IMG_641F8B4270E9-1" style="zoom:67%;">



<h3 id="新建GTMineViewController（UIViewController），GTLogin（NSObject）"><a href="#新建GTMineViewController（UIViewController），GTLogin（NSObject）" class="headerlink" title="新建GTMineViewController（UIViewController），GTLogin（NSObject）"></a>新建GTMineViewController（UIViewController），GTLogin（NSObject）</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117145701381.png" alt="image-20210117145701381"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 第四个Tab，我的页面</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@interface GTMineViewController : UIViewController</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514121138674.png" alt="image-20210514121138674"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTMineViewController.h&quot;</span><br><span class="line">#import &quot;GTLogin.h&quot;</span><br><span class="line">#import &lt;SDWebImage.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTMineViewController ()&lt;UITableViewDelegate, UITableViewDataSource&gt;//实现Delegate，DataSource</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) UITableView *tableView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UIView *tableViewHeaderView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *headerImageView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTMineViewController</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.tabBarItem.title = @&quot;我的&quot;;</span><br><span class="line">        self.tabBarItem.image = [UIImage imageNamed:@&quot;icon.bundle/home@2x.png&quot;];</span><br><span class="line">        self.tabBarItem.selectedImage = [UIImage imageNamed:@&quot;icon.bundle/home_selected@2x.png&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    self.view.backgroundColor = [UIColor whiteColor];</span><br><span class="line"></span><br><span class="line">    [self.view addSubview:(&#123;</span><br><span class="line">        _tableView = [[UITableView alloc] initWithFrame:self.view.bounds style:UITableViewStyleGrouped];</span><br><span class="line">        _tableView.delegate = self;</span><br><span class="line">        _tableView.dataSource = self;</span><br><span class="line">        _tableView;</span><br><span class="line">    &#125;)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;mineTableViewCell&quot;];</span><br><span class="line">    if (!cell) &#123;</span><br><span class="line">        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;mineTableViewCell&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (nullable UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section &#123;</span><br><span class="line">    if (!_tableViewHeaderView) &#123;</span><br><span class="line"></span><br><span class="line">        _tableViewHeaderView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, self.view.frame.size.width, 200)];</span><br><span class="line">        _tableViewHeaderView.backgroundColor = [UIColor whiteColor];</span><br><span class="line"></span><br><span class="line">        [_tableViewHeaderView addSubview:(&#123;</span><br><span class="line">            _headerImageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 30, self.view.frame.size.width, 140)];</span><br><span class="line">            _headerImageView.backgroundColor = [UIColor whiteColor];</span><br><span class="line">            _headerImageView.contentMode = UIViewContentModeScaleAspectFit;</span><br><span class="line">            _headerImageView.clipsToBounds = YES;</span><br><span class="line">            _headerImageView.userInteractionEnabled = YES;</span><br><span class="line">            _headerImageView;</span><br><span class="line">        &#125;)];</span><br><span class="line"></span><br><span class="line">        [_tableViewHeaderView addGestureRecognizer:(&#123;</span><br><span class="line">            UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(_tapImage)];</span><br><span class="line">            tapGesture;</span><br><span class="line">        &#125;)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return _tableViewHeaderView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    return 60;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section &#123;</span><br><span class="line">    return 200;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tableView:(UITableView *)tableView willDisplayHeaderView:(UIView *)view forSection:(NSInteger)section&#123;</span><br><span class="line">    if (![[GTLogin sharedLogin] isLogin]) &#123;</span><br><span class="line">        [_headerImageView setImage:[UIImage imageNamed:@&quot;icon.bundle/icon.png&quot;]];</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">       [self.headerImageView sd_setImageWithURL:[NSURL URLWithString:[GTLogin sharedLogin].avatarUrl]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    if (indexPath.row == 0) &#123;</span><br><span class="line">        cell.textLabel.text = [[GTLogin sharedLogin] isLogin] ? [GTLogin sharedLogin].nick: @&quot;昵称&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        cell.textLabel.text = [[GTLogin sharedLogin] isLogin] ? [GTLogin sharedLogin].address: @&quot;地区&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)_tapImage &#123;</span><br><span class="line"></span><br><span class="line">    __weak typeof(self) weakSelf = self;</span><br><span class="line">    if (![[GTLogin sharedLogin] isLogin]) &#123;</span><br><span class="line">        //没有登录的时候拉起登录</span><br><span class="line">        [[GTLogin sharedLogin] loginWithFinishBlock:^(BOOL isLogin) &#123;</span><br><span class="line">            __strong typeof(weakSelf) strongSelf = weakSelf;</span><br><span class="line">            //SDK流程之后判断是否登录成功</span><br><span class="line">            if (isLogin) &#123;</span><br><span class="line">                [strongSelf.tableView reloadData];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        //已经登录的退出登录</span><br><span class="line">        [[GTLogin sharedLogin] logOut];</span><br><span class="line">        [self.tableView reloadData];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514121210298.png" alt="image-20210514121210298"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">typedef void(^GTLoginFinishBlock)(BOOL isLogin);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> QQ登录和分享相关逻辑</span><br><span class="line"> */</span><br><span class="line">@interface GTLogin : NSObject</span><br><span class="line"></span><br><span class="line">@property(nonatomic, strong, readonly)NSString *nick;</span><br><span class="line">@property(nonatomic, strong, readonly)NSString *address;</span><br><span class="line">@property(nonatomic, strong, readonly)NSString *avatarUrl;</span><br><span class="line"></span><br><span class="line">+ (instancetype)sharedLogin;</span><br><span class="line"></span><br><span class="line">#pragma - mark - 登录</span><br><span class="line"></span><br><span class="line">- (BOOL)isLogin;</span><br><span class="line">- (void)loginWithFinishBlock:(GTLoginFinishBlock)finishBlock;</span><br><span class="line">- (void)logOut;</span><br><span class="line"></span><br><span class="line">#pragma mark - 分享</span><br><span class="line">- (void)shareToQQWithArticleUrl:(NSURL *)articleUrl;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514121225088.png" alt="image-20210514121225088"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTLogin.h&quot;</span><br><span class="line">#import &lt;TencentOpenAPI/QQApiInterface.h&gt;</span><br><span class="line">#import &lt;TencentOpenAPI/TencentOAuth.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTLogin () &lt;TencentSessionDelegate&gt;</span><br><span class="line">@property (nonatomic, strong, readwrite) TencentOAuth *oauth;</span><br><span class="line">@property (nonatomic, copy, readwrite) GTLoginFinishBlock finishBlock;</span><br><span class="line">@property (nonatomic, assign, readwrite) BOOL isLogin;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTLogin</span><br><span class="line"></span><br><span class="line">+ (instancetype)sharedLogin &#123;</span><br><span class="line">    static GTLogin *login;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        login = [[GTLogin alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return login;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        _isLogin = NO;</span><br><span class="line">        _oauth = [[TencentOAuth alloc] initWithAppId:@&quot;222222&quot; andDelegate:self];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isLogin &#123;</span><br><span class="line">    //登陆态失效的逻辑</span><br><span class="line">    return _isLogin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)loginWithFinishBlock:(GTLoginFinishBlock)finishBlock &#123;</span><br><span class="line">    </span><br><span class="line">    _finishBlock = [finishBlock copy];</span><br><span class="line">    </span><br><span class="line">    _oauth.authMode = kAuthModeClientSideToken;</span><br><span class="line">    [_oauth authorize:@[kOPEN_PERMISSION_GET_USER_INFO,</span><br><span class="line">                        kOPEN_PERMISSION_GET_SIMPLE_USER_INFO,</span><br><span class="line">                        kOPEN_PERMISSION_ADD_ALBUM,</span><br><span class="line">                        kOPEN_PERMISSION_ADD_ONE_BLOG,</span><br><span class="line">                        kOPEN_PERMISSION_ADD_SHARE,</span><br><span class="line">                        kOPEN_PERMISSION_ADD_TOPIC,</span><br><span class="line">                        kOPEN_PERMISSION_CHECK_PAGE_FANS,</span><br><span class="line">                        kOPEN_PERMISSION_GET_INFO,</span><br><span class="line">                        kOPEN_PERMISSION_GET_OTHER_INFO,</span><br><span class="line">                        kOPEN_PERMISSION_LIST_ALBUM,</span><br><span class="line">                        kOPEN_PERMISSION_UPLOAD_PIC,</span><br><span class="line">                        kOPEN_PERMISSION_GET_VIP_INFO,</span><br><span class="line">                        kOPEN_PERMISSION_GET_VIP_RICH_INFO]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)logOut &#123;</span><br><span class="line">    [_oauth logout:self];</span><br><span class="line">    _isLogin = NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - delegate</span><br><span class="line"></span><br><span class="line">- (void)tencentDidLogin &#123;</span><br><span class="line">    _isLogin = YES;</span><br><span class="line">    //保存openid</span><br><span class="line">    [_oauth getUserInfo];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tencentDidNotLogin:(BOOL)cancelled &#123;</span><br><span class="line">    if (_finishBlock) &#123;</span><br><span class="line">        _finishBlock(NO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tencentDidNotNetWork &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tencentDidLogout &#123;</span><br><span class="line">   //退出登录，需要清理下存储在本地的登录数据</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)getUserInfoResponse:(APIResponse *)response &#123;</span><br><span class="line">    NSDictionary *userInfo = response.jsonResponse;</span><br><span class="line">    _nick = userInfo[@&quot;nickname&quot;];</span><br><span class="line">    _address = userInfo[@&quot;city&quot;];</span><br><span class="line">    _avatarUrl = userInfo[@&quot;figureurl_qq_2&quot;];</span><br><span class="line">    if (_finishBlock) &#123;</span><br><span class="line">        _finishBlock(YES);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)shareToQQWithArticleUrl:(NSURL *)articleUrl &#123;</span><br><span class="line"></span><br><span class="line">    //登陆校验</span><br><span class="line">    //loginWithFinishBlock</span><br><span class="line"></span><br><span class="line">    QQApiNewsObject *newsObj = [QQApiNewsObject objectWithURL:articleUrl title:@&quot;iOS&quot; description:@&quot;从0开始iOS开发&quot; previewImageURL:nil];</span><br><span class="line">    SendMessageToQQReq *req = [SendMessageToQQReq reqWithContent:newsObj];</span><br><span class="line">    __unused QQApiSendResultCode sent = [QQApiInterface SendReqToQZone:req];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="进行代码的部分重构"><a href="#进行代码的部分重构" class="headerlink" title="进行代码的部分重构"></a>进行代码的部分重构</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117145940957.png" alt="image-20210117145940957"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - lefe cycle</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.tabBarItem.title = @&quot;新闻&quot;;</span><br><span class="line">        self.tabBarItem.image = [UIImage imageNamed:@&quot;icon.bundle/page@2x.png&quot;];</span><br><span class="line">        self.tabBarItem.selectedImage = [UIImage imageNamed:@&quot;icon.bundle/page_selected@2x.png&quot;];</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117150034604.png" alt="image-20210117150034604"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTMineViewController.h&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514121307337.png" alt="image-20210514121307337"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GTMineViewController *mineViewController = [[GTMineViewController alloc] init];</span><br><span class="line">  [tabbarConttroller setViewControllers:@[newsviewController,videoController,recimmendController,mineViewController]];</span><br></pre></td></tr></table></figure>

<h3 id="同时新建库文件，导入第三方库"><a href="#同时新建库文件，导入第三方库" class="headerlink" title="同时新建库文件，导入第三方库"></a>同时新建库文件，导入第三方库</h3><h3 id="添加文章分享功能"><a href="#添加文章分享功能" class="headerlink" title="添加文章分享功能"></a>添加文章分享功能</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117165521556.png" alt="image-20210117165521556"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117165542912.png" alt="image-20210117165542912"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117165558201.png" alt="image-20210117165558201"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTLogin.h&quot;</span><br><span class="line"></span><br><span class="line">self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemAction target:self action:@selector(_shareArticle)];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)_shareArticle&#123;</span><br><span class="line">    [[GTLogin sharedLogin] shareToQQWithArticleUrl:[NSURL URLWithString:self.articleUrl]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/20/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%887%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/20/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%887%EF%BC%89/" class="post-title-link" itemprop="url">oc版本的新闻App（7）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-20 12:49:00" itemprop="dateCreated datePublished" datetime="2019-04-20T12:49:00+08:00">2019-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-01 14:49:00" itemprop="dateModified" datetime="2021-02-01T14:49:00+08:00">2021-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h1><h2 id="逻辑分辨率适配"><a href="#逻辑分辨率适配" class="headerlink" title="逻辑分辨率适配"></a>逻辑分辨率适配</h2><h3 id="新建GTScreen，UIview的"><a href="#新建GTScreen，UIview的" class="headerlink" title="新建GTScreen，UIview的"></a>新建GTScreen，UIview的</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514120200459.png" alt="image-20210514120200459"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">//判断是否横竖屏</span><br><span class="line">#define IS_LANDSCAPE (UIInterfaceOrientationIsLandscape([[UIApplication sharedApplication] statusBarOrientation]))</span><br><span class="line"></span><br><span class="line">//横屏时屏幕的高度为宽度</span><br><span class="line">#define SCREEN_WIDTH (IS_LANDSCAPE ? [[UIScreen mainScreen ] bounds].size.height : [[UIScreen mainScreen ] bounds].size.width)</span><br><span class="line">//竖屏</span><br><span class="line">#define SCREEN_HEIGHT (IS_LANDSCAPE ? [[UIScreen mainScreen ] bounds].size.width : [[UIScreen mainScreen ] bounds].size.height)</span><br><span class="line"></span><br><span class="line">#define UI(x) UIAdapter(x)</span><br><span class="line">#define UIRect(x,y,width,height) UIRectAdapter(x,y,width,height)</span><br><span class="line"></span><br><span class="line">//按比例扩大或者缩小</span><br><span class="line">static inline NSInteger UIAdapter (float x)&#123;</span><br><span class="line">    //1 - 分机型 特定的比例</span><br><span class="line">    </span><br><span class="line">    //2 - 屏幕宽度按比例适配</span><br><span class="line">    CGFloat scale = 414 / SCREEN_WIDTH; // 414/当前屏幕的宽度</span><br><span class="line">    return (NSInteger)x /scale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//...完善其他方法..size..rect..origin..</span><br><span class="line">static inline CGRect UIRectAdapter(x,y,width,height)&#123;</span><br><span class="line">    return CGRectMake(UIAdapter(x), UIAdapter(y), UIAdapter(width), UIAdapter(height));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@interface GTScreen : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116171550223.png" alt="image-20210116171550223"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116172001868.png" alt="image-20210116172001868"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTScreen.h&quot;</span><br><span class="line"></span><br><span class="line">self.titleLabel = [[UILabel alloc] initWithFrame:UIRect(20, 15, 270, 50)];</span><br><span class="line"></span><br><span class="line">self.sourceLabel = [[UILabel alloc] initWithFrame:UIRect(20, 70, 50, 20)];</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116172047283.png" alt="image-20210116172047283"></p>
<h2 id="iphoneX异形屏适配"><a href="#iphoneX异形屏适配" class="headerlink" title="iphoneX异形屏适配"></a>iphoneX异形屏适配</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116183757600.png" alt="image-20210116183757600"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTScreen.h&quot;</span><br><span class="line"></span><br><span class="line">self.webView = [[WKWebView alloc] initWithFrame:CGRectMake(0, STATUSBARHEIGHT + 44, self.view.frame.size.width, self.view.frame.size.height - STATUSBARHEIGHT - 44)];</span><br><span class="line"></span><br><span class="line">self.progressView = [[UIProgressView alloc] initWithFrame:CGRectMake(0, STATUSBARHEIGHT + 44, self.view.frame.size.width, 50)];</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116225231908.png" alt="image-20210116225231908"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//宏判断设备屏幕尺寸</span><br><span class="line">#define IS_IPHONE_X_XR_MAX (IS_IPHONE_X || IS_IPHONE_XR || IS_IPHONE_XMAX)</span><br><span class="line"></span><br><span class="line">#define IS_IPHONE_X (SCREEN_WIDTH == [GTScreen sizeFor58Inch].width &amp;&amp; SCREEN_HEIGHT == [GTScreen sizeFor58Inch].height)</span><br><span class="line">#define IS_IPHONE_XR (SCREEN_WIDTH == [GTScreen sizeFor61Inch].width &amp;&amp; SCREEN_HEIGHT == [GTScreen sizeFor61Inch].height &amp;&amp; [UIScreen mainScreen].scale == 2)</span><br><span class="line">#define IS_IPHONE_XMAX (SCREEN_WIDTH == [GTScreen sizeFor65Inch].width &amp;&amp; SCREEN_HEIGHT == [GTScreen sizeFor65Inch].height &amp;&amp; [UIScreen mainScreen].scale == 3)</span><br><span class="line"></span><br><span class="line">//如果是刘海屏返回44，如不是则返回20</span><br><span class="line">#define STATUSBARHEIGHT (IS_IPHONE_X_XR_MAX ? 44 : 20)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116225324801.png" alt="image-20210116225324801"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//iphone xs max</span><br><span class="line">+ (CGSize)sizeFor65Inch;</span><br><span class="line"></span><br><span class="line">//iphone xr</span><br><span class="line">+ (CGSize)sizeFor61Inch;</span><br><span class="line"></span><br><span class="line">// iphonex</span><br><span class="line">+ (CGSize)sizeFor58Inch;</span><br><span class="line"></span><br><span class="line">//...其它机型</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116225402949.png" alt="image-20210116225402949"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//iphone xs max</span><br><span class="line">+ (CGSize)sizeFor65Inch&#123;</span><br><span class="line">    return CGSizeMake(414,896);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//iphone xr</span><br><span class="line">+ (CGSize)sizeFor61Inch&#123;</span><br><span class="line">    return CGSizeMake(414,896);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// iphonex</span><br><span class="line">+ (CGSize)sizeFor58Inch&#123;</span><br><span class="line">    return CGSizeMake(375,812);</span><br><span class="line">&#125;</span><br><span class="line">//plus</span><br><span class="line">//4 /5</span><br></pre></td></tr></table></figure>

<h2 id="启动图片的实现"><a href="#启动图片的实现" class="headerlink" title="启动图片的实现"></a>启动图片的实现</h2><h3 id="删掉storyboard"><a href="#删掉storyboard" class="headerlink" title="删掉storyboard"></a>删掉storyboard</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116225849059.png" alt="image-20210116225849059"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116230001983.png" alt="image-20210116230001983"></p>
<p>搜索填好</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116230447373.png" alt="image-20210116230447373"></p>
<p>导入图片，创建GTSplashView</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116232853199.png" alt="image-20210116232853199"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116235103501.png" alt="image-20210116235103501"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTSplashView.h&quot;</span><br><span class="line">#import &quot;GTScreen.h&quot;</span><br><span class="line"></span><br><span class="line">@interface GTSplashView()</span><br><span class="line"></span><br><span class="line">@property(nonatomic, strong, readwrite)UIButton *button;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTSplashView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.image = [UIImage imageNamed:@&quot;icon.bundle/splash.png&quot;];</span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _button = [[UIButton alloc] initWithFrame:UIRect(330, 100, 60, 40)];</span><br><span class="line">            _button.backgroundColor = [UIColor lightGrayColor];</span><br><span class="line">            [_button setTitle:@&quot;跳过&quot; forState:UIControlStateNormal];</span><br><span class="line">            [_button addTarget:self action:@selector(_removeSplashView) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">            _button;</span><br><span class="line">        &#125;)];</span><br><span class="line">        self.userInteractionEnabled = YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark -</span><br><span class="line"></span><br><span class="line">- (void)_removeSplashView&#123;</span><br><span class="line">    [self removeFromSuperview];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116235151612.png" alt="image-20210116235151612"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116235210866.png" alt="image-20210116235210866"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTSplashView.h&quot;</span><br><span class="line"></span><br><span class="line">[self.window addSubview:(&#123;</span><br><span class="line">      GTSplashView *splashView = [[GTSplashView alloc] initWithFrame:self.window.bounds];</span><br><span class="line">      splashView;</span><br><span class="line">  &#125;)];</span><br></pre></td></tr></table></figure>

<h1 id="使⽤-URL-Scheme-⽀持-App-启动、跳转及"><a href="#使⽤-URL-Scheme-⽀持-App-启动、跳转及" class="headerlink" title="使⽤ URL Scheme ⽀持 App 启动、跳转及"></a>使⽤ URL Scheme ⽀持 App 启动、跳转及</h1><h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><h3 id="URL-Scheme"><a href="#URL-Scheme" class="headerlink" title="URL Scheme"></a>URL Scheme</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117002438219.png" alt="image-20210117002438219"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - URL SCHEME</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey, id&gt; *)options&#123;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117002658783.png" alt="image-20210117002658783"></p>
<h1 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h1><h2 id="Target-Action"><a href="#Target-Action" class="headerlink" title="Target-Action"></a>Target-Action</h2><p>新建GTMediator</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117003457618.png" alt="image-20210117003457618"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117005557021.png" alt="image-20210117005557021"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTMediator.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation GTMediator</span><br><span class="line"></span><br><span class="line">+ (__kindof UIViewController *)detailViewControllerWithUrl:(NSString *)detailUrl&#123;</span><br><span class="line">    </span><br><span class="line">    Class detailCls = NSClassFromString(@&quot;GTDetailViewController&quot;);</span><br><span class="line">    </span><br><span class="line">    UIViewController *controller = [[detailCls alloc] performSelector:NSSelectorFromString(@&quot;initWithUrlString:&quot;) withObject:detailUrl];</span><br><span class="line">    return controller;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117005627579.png" alt="image-20210117005627579"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@interface GTMediator : NSObject</span><br><span class="line"></span><br><span class="line">+ (__kindof UIViewController *)detailViewControllerWithUrl:(NSString *)detailUrl;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117005650509.png" alt="image-20210117005650509"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117005726733.png" alt="image-20210117005726733"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTMediator.h&quot;</span><br><span class="line"></span><br><span class="line">    __kindof UIViewController *detailController = [GTMediator detailViewControllerWithUrl:item.articleUrl];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    detailController.title = [NSString stringWithFormat:@&quot;%@&quot;,@(indexPath.row)];//设置标题，第几个显示第几</span><br><span class="line">    [self.navigationController pushViewController:detailController animated:YES];//推进新页面</span><br></pre></td></tr></table></figure>

<h2 id="使用URL-scheme解耦"><a href="#使用URL-scheme解耦" class="headerlink" title="使用URL scheme解耦"></a>使用URL scheme解耦</h2><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117011916978.png" alt="image-20210117011916978"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTMediator.h&quot;</span><br><span class="line"></span><br><span class="line">+ (void)load &#123;</span><br><span class="line">    [GTMediator registerScheme:@&quot;detail://&quot; processBlock:^(NSDictionary * _Nonnull params) &#123;</span><br><span class="line">        NSString *url = (NSString *)[params objectForKey:@&quot;url&quot;];</span><br><span class="line">        UINavigationController *navigationController = (UINavigationController *)[params objectForKey:@&quot;controller&quot;];</span><br><span class="line">        GTDetailViewController *controller = [[GTDetailViewController alloc] initWithUrlString:url];</span><br><span class="line">//        controller.title = [NSString stringWithFormat:@&quot;%@&quot;, @(indexPath.row)];</span><br><span class="line">        [navigationController pushViewController:controller animated:YES];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117011953473.png" alt="image-20210117011953473"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//url scheme</span><br><span class="line">typedef void(^GTMediatorProcessBlock)(NSDictionary *params);//注册的函数</span><br><span class="line">+ (void)registerScheme:(NSString *)scheme processBlock:(GTMediatorProcessBlock)processBlock;//定义一个Block</span><br><span class="line">+ (void)openUrl:(NSString *)url params:(NSDictionary *)params;//openUrl传入参数</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117012021988.png" alt="image-20210117012021988"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark -</span><br><span class="line">+ (NSMutableDictionary *)mediatorCache&#123;</span><br><span class="line">    static NSMutableDictionary *cache;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        cache = @&#123;&#125;.mutableCopy;</span><br><span class="line">    &#125;);</span><br><span class="line">    return cache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)registerScheme:(NSString *)scheme processBlock:(GTMediatorProcessBlock)processBlock&#123;</span><br><span class="line">    if (scheme &amp;&amp; processBlock) &#123;</span><br><span class="line">        [[[self class] mediatorCache] setObject:processBlock forKey:scheme];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)openUrl:(NSString *)url params:(NSDictionary *)params&#123;</span><br><span class="line">    GTMediatorProcessBlock block = [[[self class] mediatorCache] objectForKey:url];</span><br><span class="line">    if (block) &#123;</span><br><span class="line">        block(params);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210117012050387.png" alt="image-20210117012050387"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[GTMediator openUrl:@&quot;detail://&quot; params:@&#123;@&quot;url&quot;:item.articleUrl,@&quot;controller&quot;:self.navigationController&#125;];</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/19/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%886%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="zhuguanliang">
      <meta itemprop="description" content=" iOS developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我不是诸葛亮">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/oc%E7%89%88%E6%9C%AC%E7%9A%84%E6%96%B0%E9%97%BBApp%EF%BC%886%EF%BC%89/" class="post-title-link" itemprop="url">oc版本的新闻App（6）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-19 12:49:00" itemprop="dateCreated datePublished" datetime="2019-04-19T12:49:00+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-01 14:49:00" itemprop="dateModified" datetime="2021-02-01T14:49:00+08:00">2021-02-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="重构视频列表"><a href="#重构视频列表" class="headerlink" title="重构视频列表"></a>重构视频列表</h2><h3 id="新建VideoController文件夹，将之前建好的放进去"><a href="#新建VideoController文件夹，将之前建好的放进去" class="headerlink" title="新建VideoController文件夹，将之前建好的放进去"></a>新建VideoController文件夹，将之前建好的放进去</h3><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210113215939815.png" alt="image-20210113215939815" style="zoom:50%;">



<h3 id="新建GTVideoCoverView"><a href="#新建GTVideoCoverView" class="headerlink" title="新建GTVideoCoverView"></a>新建GTVideoCoverView</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114152957357.png"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114004937065.png" alt="image-20210114004937065"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514112223575.png" alt="image-20210514112223575"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 视频ViewController collectionView Item</span><br><span class="line"> */</span><br><span class="line">@interface GTVideoCoverView : UICollectionViewCell</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 根据数据布局，封面图&amp;播放 url</span><br><span class="line"> */</span><br><span class="line">- (void)layoutWithVideoCoverUrl:(NSString *)videoCoverUrl videoUrl:(NSString *)videoUrl;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114151736592.png" alt="image-20210114151736592"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTVideoCoverView.h&quot;</span><br><span class="line">@interface GTVideoCoverView ()</span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *coverView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *playButton;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSString *videoUrl;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTVideoCoverView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _coverView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, frame.size.width, frame.size.height)];</span><br><span class="line">            _coverView;</span><br><span class="line">        &#125;)];</span><br><span class="line"></span><br><span class="line">        [_coverView addSubview:(&#123;</span><br><span class="line">            _playButton = [[UIImageView alloc] initWithFrame:CGRectMake((frame.size.width - 50)/2, (frame.size.height - 50)/2, 50, 50)];</span><br><span class="line">            _playButton.image = [UIImage imageNamed:@&quot;icon.bundle/ VIdeobofang.png&quot;];</span><br><span class="line">            _playButton;</span><br><span class="line">        &#125;)];</span><br><span class="line">        //点击全部Item都支持播放</span><br><span class="line">        UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(_tapToPlay)];</span><br><span class="line">        [self addGestureRecognizer:tapGesture];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - public method</span><br><span class="line"></span><br><span class="line">- (void)layoutWithVideoCoverUrl:(NSString *)videoCoverUrl videoUrl:(NSString *)videoUrl &#123;</span><br><span class="line">    _coverView.image = [UIImage imageNamed:videoCoverUrl];</span><br><span class="line">    _videoUrl = videoUrl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - private method</span><br><span class="line"></span><br><span class="line">- (void)_tapToPlay &#123;</span><br><span class="line">    //在当前Item上播放视频</span><br><span class="line">    NSLog(@&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514112314318.png" alt="image-20210514112314318"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTVideoCoverView.h&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114151938859.png" alt="image-20210114151938859"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114152015694.png" alt="image-20210114152015694"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Scheme    </span><br><span class="line">1    </span><br><span class="line">    flowLayout.itemSize = CGSizeMake(self.view.frame.size.width,self.view.frame.size.width / 16*9);</span><br><span class="line">    </span><br><span class="line">2    </span><br><span class="line">    [collectionView registerClass:[GTVideoCoverView class] forCellWithReuseIdentifier:@&quot;GTVideoCoverView&quot;];//注册重用的cell</span><br><span class="line">    </span><br><span class="line">3    </span><br><span class="line">    UICollectionViewCell *cell = [collectionView dequeueReusableCellWithReuseIdentifier:@&quot;GTVideoCoverView&quot; forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    if ([cell isKindOfClass:[GTVideoCoverView class]]) &#123;</span><br><span class="line">        //方便讲解事例数据</span><br><span class="line">        [(GTVideoCoverView *)cell layoutWithVideoCoverUrl:@&quot;icon.bundle/Video.png&quot; videoUrl:@&quot;https://0x9.me/PzdXc&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<h3 id="添加播放功能"><a href="#添加播放功能" class="headerlink" title="添加播放功能"></a>添加播放功能</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514112609925.png" alt="image-20210514112609925"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114172430253.png" alt="image-20210114172430253"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NSURL *videoURL = [NSURL URLWithString:_videoUrl];</span><br><span class="line"></span><br><span class="line">AVAsset *asset = [AVAsset assetWithURL:videoURL];</span><br><span class="line"></span><br><span class="line">AVPlayer *videoItem = [AVPlayerItem playerItemWithAsset:asset];</span><br><span class="line"></span><br><span class="line">AVPlayer *avPlayer = [AVPlayer playerWithPlayerItem:videoItem];</span><br><span class="line"></span><br><span class="line">AVPlayerLayer *playerLayer = [AVPlayerLayer playerLayerWithPlayer:avPlayer];</span><br><span class="line">playerLayer.frame = _coverView.bounds;</span><br><span class="line">[_coverView.layer addSublayer:playerLayer];</span><br><span class="line"></span><br><span class="line">[avPlayer play];</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514112701308.png" alt="image-20210514112701308"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(GTVideoCoverView *)cell layoutWithVideoCoverUrl:@&quot;icon.bundle/Video.png&quot; videoUrl:@&quot;http://sns-video-qc.xhscdn.com/d43514414bf02ff023c52b80362e914b663bdc83_v1_ln?sign=6bbeae5060160f3cd1f84e708c9413f7&amp;t=6001bad4&quot;];</span><br></pre></td></tr></table></figure>

<p>视频播放完成获得通知</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114174707956.png" alt="image-20210114174707956"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(_handlePlayEnd) name:AVPlayerItemDidPlayToEndTimeNotification object:nil];//注册通知</span><br><span class="line">&#125;</span><br><span class="line">return self;</span><br><span class="line">[[NSNotificationCenter defaultCenter] removeObserver:self];//移除</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114174756491.png" alt="image-20210114174756491"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void) _handlePlayEnd&#123;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="播放完成退出播放操作"><a href="#播放完成退出播放操作" class="headerlink" title="播放完成退出播放操作"></a>播放完成退出播放操作</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114180032098.png" alt="image-20210114180032098"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong, readwrite) AVPlayerItem *videoItem;</span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayer *avPlayer;</span><br><span class="line">@property (nonatomic, copy, readwrite) AVPlayerLayer *playerLayer;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114180119940.png" alt="image-20210114180119940"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    _videoItem = [AVPlayerItem playerItemWithAsset:asset];</span><br><span class="line">    </span><br><span class="line">    _avPlayer = [AVPlayer playerWithPlayerItem:_videoItem];</span><br><span class="line">    </span><br><span class="line">    _playerLayer = [AVPlayerLayer playerLayerWithPlayer:_avPlayer];</span><br><span class="line">    _playerLayer.frame = _coverView.bounds;</span><br><span class="line">    [_coverView.layer addSublayer:_playerLayer];</span><br><span class="line">    </span><br><span class="line">    [_avPlayer play];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">- (void) _handlePlayEnd&#123;</span><br><span class="line">    [_playerLayer removeFromSuperlayer];</span><br><span class="line">    _videoItem = nil;</span><br><span class="line">    _avPlayer = nil;</span><br></pre></td></tr></table></figure>

<h3 id="通过KVO监听播放资源的状态"><a href="#通过KVO监听播放资源的状态" class="headerlink" title="通过KVO监听播放资源的状态"></a>通过KVO监听播放资源的状态</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114182745589.png" alt="image-20210114182745589"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114182904689.png" alt="image-20210114182904689"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    [_videoItem removeObserver:self forKeyPath:@&quot;status&quot;];</span><br><span class="line">    </span><br><span class="line">    [_videoItem addObserver:self forKeyPath:@&quot;status&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #pragma mark - KVO</span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123;</span><br><span class="line">    if ([keyPath isEqualToString:@&quot;status&quot;]) &#123;</span><br><span class="line">        if (((NSNumber *)[change objectForKey:NSKeyValueChangeNewKey]).integerValue == AVPlayerItemStatusReadyToPlay) &#123;</span><br><span class="line">            [_avPlayer play];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            NSLog(@&quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="监听视频播放的缓冲与进度（1）"><a href="#监听视频播放的缓冲与进度（1）" class="headerlink" title="监听视频播放的缓冲与进度（1）"></a>监听视频播放的缓冲与进度（1）</h3><p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114194035692.png" alt="image-20210114194035692"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[_videoItem removeObserver:self forKeyPath:@&quot;loadedRimeRanges&quot;];</span><br><span class="line"></span><br><span class="line">[_videoItem addObserver:self forKeyPath:@&quot;loadedRimeRanges&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br><span class="line"></span><br><span class="line">CMTime duration = _videoItem.duration;</span><br><span class="line">CGFloat videoDuration = CMTimeGetSeconds(duration);</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114194219900.png" alt="image-20210114194219900"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    [_avPlayer addPeriodicTimeObserverForInterval:CMTimeMake(1,1) queue:dispatch_get_main_queue() usingBlock:^(CMTime time) &#123;</span><br><span class="line">        NSLog(@&quot;播放进度：%@&quot;,@(CMTimeGetSeconds(time)));</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [_avPlayer seekToTime:CMTimeMake(0, 1)];</span><br><span class="line">    [_avPlayer play];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514112814433.png" alt="image-20210514112814433"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#125;else if ([keyPath isEqualToString:@&quot;loadedRimeRanges&quot;])&#123;</span><br><span class="line">    NSLog(@&quot;缓冲：%@&quot;,[change objectForKey:NSKeyValueChangeNewKey]);</span><br></pre></td></tr></table></figure>

<h3 id="监听视频播放的缓冲与进度（2）"><a href="#监听视频播放的缓冲与进度（2）" class="headerlink" title="监听视频播放的缓冲与进度（2）"></a>监听视频播放的缓冲与进度（2）</h3><h2 id="建立一个视频播放器"><a href="#建立一个视频播放器" class="headerlink" title="建立一个视频播放器"></a>建立一个视频播放器</h2><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114194703986.png" alt="image-20210114194703986" style="zoom:50%;">

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114230437235.png" alt="image-20210114230437235"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface GTVideoPlayer : NSObject</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 全局播放器单例</span><br><span class="line"> */</span><br><span class="line">+ (GTVideoPlayer *)Player;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 在指定View上 通过url播放视频</span><br><span class="line"> */</span><br><span class="line">- (void)playVideoWithUrl:(NSString *)videoUrl attachView:(UIView *)attachView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114230544663.png" alt="image-20210114230544663" style="zoom:50%;">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTVideoPlayer.h&quot;</span><br><span class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface GTVideoPlayer()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayerItem *videoItem;</span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayer *avPlayer;</span><br><span class="line">@property (nonatomic, copy, readwrite) AVPlayerLayer *playerLayer;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTVideoPlayer</span><br><span class="line"></span><br><span class="line">+ (GTVideoPlayer *)Player &#123;</span><br><span class="line">    static GTVideoPlayer *player;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        player = [[GTVideoPlayer alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return player;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)playVideoWithUrl:(NSString *)videoUrl attachView:(UIView *)attachView&#123;</span><br><span class="line">    </span><br><span class="line">    //首先停止播放</span><br><span class="line">    [self _stopPlay];</span><br><span class="line">    </span><br><span class="line">    //在当前Item上播放视频</span><br><span class="line">    NSURL *videoURL = [NSURL URLWithString:videoUrl];</span><br><span class="line">    </span><br><span class="line">    AVAsset *asset = [AVAsset assetWithURL:videoURL];</span><br><span class="line"></span><br><span class="line">    _videoItem = [AVPlayerItem playerItemWithAsset:asset];</span><br><span class="line">    [_videoItem addObserver:self forKeyPath:@&quot;status&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br><span class="line">    [_videoItem addObserver:self forKeyPath:@&quot;loadedRimeRanges&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br><span class="line">    </span><br><span class="line">    CMTime duration = _videoItem.duration;</span><br><span class="line">    CGFloat videoDuration = CMTimeGetSeconds(duration);</span><br><span class="line">    </span><br><span class="line">    _avPlayer = [AVPlayer playerWithPlayerItem:_videoItem];</span><br><span class="line">    [_avPlayer addPeriodicTimeObserverForInterval:CMTimeMake(1,1) queue:dispatch_get_main_queue() usingBlock:^(CMTime time) &#123;</span><br><span class="line">        NSLog(@&quot;播放进度：%@&quot;,@(CMTimeGetSeconds(time)));</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    _playerLayer = [AVPlayerLayer playerLayerWithPlayer:_avPlayer];</span><br><span class="line">    _playerLayer.frame = attachView.bounds;</span><br><span class="line">    [attachView.layer addSublayer:_playerLayer];</span><br><span class="line">    </span><br><span class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(_handlePlayEnd) name:AVPlayerItemDidPlayToEndTimeNotification object:nil];//注册通知</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">- (void)_stopPlay &#123;</span><br><span class="line">    //移除监听</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [_playerLayer removeFromSuperlayer];</span><br><span class="line">    </span><br><span class="line">    [_videoItem removeObserver:self forKeyPath:@&quot;status&quot;];</span><br><span class="line">    [_videoItem removeObserver:self forKeyPath:@&quot;loadedRimeRanges&quot;];</span><br><span class="line">    _videoItem = nil;</span><br><span class="line">    </span><br><span class="line">    _avPlayer = nil;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">- (void) _handlePlayEnd&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    [_avPlayer seekToTime:CMTimeMake(0, 1)];</span><br><span class="line">    [_avPlayer play];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - KVO</span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123;</span><br><span class="line">    if ([keyPath isEqualToString:@&quot;status&quot;]) &#123;</span><br><span class="line">        if (((NSNumber *)[change objectForKey:NSKeyValueChangeNewKey]).integerValue == AVPlayerItemStatusReadyToPlay) &#123;</span><br><span class="line">            [_avPlayer play];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            NSLog(@&quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else if ([keyPath isEqualToString:@&quot;loadedRimeRanges&quot;])&#123;</span><br><span class="line">        NSLog(@&quot;缓冲：%@&quot;,[change objectForKey:NSKeyValueChangeNewKey]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114231703891.png" alt="image-20210114231703891"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114231729970.png" alt="image-20210114231729970"></p>
<h3 id="使用AutoLayout实现列表toolbar，并添加上相应图片"><a href="#使用AutoLayout实现列表toolbar，并添加上相应图片" class="headerlink" title="使用AutoLayout实现列表toolbar，并添加上相应图片"></a>使用AutoLayout实现列表toolbar，并添加上相应图片</h3><p>新建GTVideoToolbar</p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210114232655759.png" alt="image-20210114232655759"></p>
<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116151820470.png" alt="image-20210116151820470"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">#define GTVideoToolbarHeight 60</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface GTVideoToolbar : UIView</span><br><span class="line"></span><br><span class="line">- (void)layoutWithModel:(id)model;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116151916188.png" alt="image-20210116151916188"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTVideoToolbar.h&quot;</span><br><span class="line"></span><br><span class="line">@interface GTVideoToolbar ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *avatorImageView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UILabel *nickLabel;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *commentImageView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UILabel *commentLabel;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *likeImageView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UILabel *likeLabel;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) UIImageView *shareImageView;</span><br><span class="line">@property (nonatomic, strong, readwrite) UILabel *shareLabel;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation GTVideoToolbar</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line"></span><br><span class="line">        self.backgroundColor = [UIColor whiteColor];</span><br><span class="line"></span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _avatorImageView = [[UIImageView alloc] initWithFrame:CGRectZero];</span><br><span class="line">            _avatorImageView.layer.masksToBounds = YES;</span><br><span class="line">            _avatorImageView.layer.cornerRadius = 15;</span><br><span class="line">            _avatorImageView.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line">            _avatorImageView;</span><br><span class="line">        &#125;)];</span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _nickLabel = [[UILabel alloc] init];</span><br><span class="line">            _nickLabel.font = [UIFont systemFontOfSize:15];</span><br><span class="line">            _nickLabel.textColor = [UIColor lightGrayColor];</span><br><span class="line">            _nickLabel.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line">            _nickLabel;</span><br><span class="line">        &#125;)];</span><br><span class="line"></span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _commentImageView = [[UIImageView alloc] initWithFrame:CGRectZero];</span><br><span class="line">            _commentImageView.layer.masksToBounds = YES;</span><br><span class="line">            _commentImageView.layer.cornerRadius = 15;</span><br><span class="line">            _commentImageView.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line"></span><br><span class="line">            _commentImageView;</span><br><span class="line">        &#125;)];</span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _commentLabel = [[UILabel alloc] init];</span><br><span class="line">            _commentLabel.font = [UIFont systemFontOfSize:15];</span><br><span class="line">            _commentLabel.textColor = [UIColor lightGrayColor];</span><br><span class="line">            _commentLabel.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line"></span><br><span class="line">            _commentLabel;</span><br><span class="line">        &#125;)];</span><br><span class="line"></span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _likeImageView = [[UIImageView alloc] initWithFrame:CGRectZero];</span><br><span class="line">            _likeImageView.layer.masksToBounds = YES;</span><br><span class="line">            _likeImageView.layer.cornerRadius = 15;</span><br><span class="line">            _likeImageView.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line"></span><br><span class="line">            _likeImageView;</span><br><span class="line">        &#125;)];</span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _likeLabel = [[UILabel alloc] init];</span><br><span class="line">            _likeLabel.font = [UIFont systemFontOfSize:15];</span><br><span class="line">            _likeLabel.textColor = [UIColor lightGrayColor];</span><br><span class="line">            _likeLabel.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line"></span><br><span class="line">            _likeLabel;</span><br><span class="line">        &#125;)];</span><br><span class="line"></span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _shareImageView = [[UIImageView alloc] initWithFrame:CGRectZero];</span><br><span class="line">            _shareImageView.layer.masksToBounds = YES;</span><br><span class="line">            _shareImageView.layer.cornerRadius = 15;</span><br><span class="line">            _shareImageView.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line">            _shareImageView.contentMode = UIViewContentModeScaleToFill;</span><br><span class="line">            _shareImageView;</span><br><span class="line">        &#125;)];</span><br><span class="line">        </span><br><span class="line">        [self addSubview:(&#123;</span><br><span class="line">            _shareLabel = [[UILabel alloc] init];</span><br><span class="line">            _shareLabel.font = [UIFont systemFontOfSize:15];</span><br><span class="line">            _shareLabel.textColor = [UIColor lightGrayColor];</span><br><span class="line">            _shareLabel.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line">            _shareLabel;</span><br><span class="line">        &#125;)];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutWithModel:(id)model &#123;</span><br><span class="line"></span><br><span class="line">    _avatorImageView.image = [UIImage imageNamed:@&quot;icon.bundle/icon.png&quot;];</span><br><span class="line">    _nickLabel.text = @&quot;北京时间&quot;;</span><br><span class="line"></span><br><span class="line">    _commentImageView.image = [UIImage imageNamed:@&quot;comment&quot;];</span><br><span class="line">    _commentLabel.text = @&quot;100&quot;;</span><br><span class="line"></span><br><span class="line">    _likeImageView.image = [UIImage imageNamed:@&quot;praise&quot;];</span><br><span class="line">    _likeLabel.text = @&quot;25&quot;;</span><br><span class="line"></span><br><span class="line">    _shareImageView.image = [UIImage imageNamed:@&quot;share&quot;];</span><br><span class="line">    _shareLabel.text = @&quot;分享&quot;;</span><br><span class="line"></span><br><span class="line">    [NSLayoutConstraint activateConstraints:@[</span><br><span class="line"></span><br><span class="line">         [NSLayoutConstraint constraintWithItem:_avatorImageView</span><br><span class="line">                                      attribute:NSLayoutAttributeCenterY</span><br><span class="line">                                      relatedBy:NSLayoutRelationEqual</span><br><span class="line">                                         toItem:self</span><br><span class="line">                                      attribute:NSLayoutAttributeCenterY</span><br><span class="line">                                     multiplier:1</span><br><span class="line">                                       constant:0],</span><br><span class="line"></span><br><span class="line">         [NSLayoutConstraint constraintWithItem:_avatorImageView</span><br><span class="line">                                      attribute:NSLayoutAttributeLeft</span><br><span class="line">                                      relatedBy:NSLayoutRelationEqual</span><br><span class="line">                                         toItem:self</span><br><span class="line">                                      attribute:NSLayoutAttributeLeft</span><br><span class="line">                                     multiplier:1</span><br><span class="line">                                       constant:15],</span><br><span class="line"></span><br><span class="line">         [NSLayoutConstraint constraintWithItem:_avatorImageView</span><br><span class="line">                                      attribute:NSLayoutAttributeWidth</span><br><span class="line">                                      relatedBy:NSLayoutRelationEqual</span><br><span class="line">                                         toItem:nil</span><br><span class="line">                                      attribute:NSLayoutAttributeNotAnAttribute</span><br><span class="line">                                     multiplier:1</span><br><span class="line">                                       constant:30],</span><br><span class="line"></span><br><span class="line">         [NSLayoutConstraint constraintWithItem:_avatorImageView</span><br><span class="line">                                      attribute:NSLayoutAttributeHeight</span><br><span class="line">                                      relatedBy:NSLayoutRelationEqual</span><br><span class="line">                                         toItem:nil</span><br><span class="line">                                      attribute:NSLayoutAttributeNotAnAttribute</span><br><span class="line">                                     multiplier:1</span><br><span class="line">                                       constant:30],</span><br><span class="line"></span><br><span class="line">         [NSLayoutConstraint constraintWithItem:_nickLabel</span><br><span class="line">                                      attribute:NSLayoutAttributeCenterY</span><br><span class="line">                                      relatedBy:NSLayoutRelationEqual</span><br><span class="line">                                         toItem:_avatorImageView</span><br><span class="line">                                      attribute:NSLayoutAttributeCenterY</span><br><span class="line">                                     multiplier:1</span><br><span class="line">                                       constant:0],</span><br><span class="line"></span><br><span class="line">         [NSLayoutConstraint constraintWithItem:_nickLabel</span><br><span class="line">                                      attribute:NSLayoutAttributeLeft</span><br><span class="line">                                      relatedBy:NSLayoutRelationEqual</span><br><span class="line">                                         toItem:_avatorImageView</span><br><span class="line">                                      attribute:NSLayoutAttributeRight</span><br><span class="line">                                     multiplier:1</span><br><span class="line">                                       constant:0],</span><br><span class="line"></span><br><span class="line">    ]];</span><br><span class="line"></span><br><span class="line">    NSString *vflString = @&quot;H:|-15-[_avatorImageView]-0-[_nickLabel]-(&gt;=0)-[_commentImageView(==_avatorImageView)]-0-[_commentLabel]-15-[_likeImageView(==_avatorImageView)]-0-[_likeLabel]-15-[_shareImageView(==_avatorImageView)]-0-[_shareLabel]-15-|&quot;;</span><br><span class="line"></span><br><span class="line">    [NSLayoutConstraint activateConstraints:[NSLayoutConstraint constraintsWithVisualFormat:vflString options:NSLayoutFormatAlignAllCenterY metrics:nil views:NSDictionaryOfVariableBindings(_avatorImageView, _nickLabel, _commentImageView, _commentLabel, _likeImageView, _likeLabel, _shareImageView, _shareLabel)]];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116152041731.png" alt="image-20210116152041731"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTVideoToolbar.h&quot;</span><br><span class="line"></span><br><span class="line">    flowLayout.itemSize = CGSizeMake(self.view.frame.size.width,self.view.frame.size.width / 16 * 9 + GTVideoToolbarHeight);</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116152203496.png" alt="image-20210116152203496"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;GTVideoToolbar.h&quot;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong, readwrite) GTVideoToolbar *toolbar;</span><br><span class="line"></span><br><span class="line">_coverView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, frame.size.width, frame.size.height - GTVideoToolbarHeight)];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_playButton = [[UIImageView alloc] initWithFrame:CGRectMake((frame.size.width - 50)/2, (frame.size.height - GTVideoToolbarHeight - 50)/2, 50, 50)];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[self addSubview:(&#123;</span><br><span class="line">_toolbar = [[GTVideoToolbar alloc] initWithFrame:CGRectMake(0, _coverView.bounds.size.height, frame.size.width, GTVideoToolbarHeight)];</span><br><span class="line">            _toolbar;</span><br><span class="line">        &#125;)];</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210116152356166.png" alt="image-20210116152356166"></p>
<img src="https://gitee.com/zhu565615430/images/raw/master/imas/image-20210514114233708.png" alt="image-20210514114233708" style="zoom:50%;">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhuguanliang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">zhuguanliang</p>
  <div class="site-description" itemprop="description"> iOS developer</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhuguanliang</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


</body>
</html>
